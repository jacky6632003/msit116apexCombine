@{
    ViewBag.Title = "寶碩投資績效系統_股票交易系統";
}

@section styles{
    <style>
        .tablebtn {
            color: #132eff;
        }

            .tablebtn:hover {
                color: #fc00ff
            }

            .tablebtn:active {
                color: #ff0000;
            }

        .Menupage {
            overflow: auto;
            padding-left: 0;
        }

            .Menupage li {
                float: left;
                list-style-type: none;
                background-color: black;
                color: #fee9b9;
                border-top: 1px solid #ffd800;
                margin: 5px;                
            }

        #overlay {
            position: fixed;
            display: none;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.75);
            z-index: 2;
            cursor: pointer;
            padding: 200px;
        }

        #overlay2 {
            position: fixed;
            display: none;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.75);
            z-index: 2;
            cursor: pointer;
            padding: 200px;
        }


        #overlay3 {
            position: fixed;
            display: none;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.9);
            z-index: 2;
            cursor: pointer;
            padding: 120px;
        }

        .Developerbtn {
            color: #227700;
        }
            .Developerbtn:hover {
                color: #FF8800
            }

            .Developerbtn:active {
                color: #ff0000;
            }
        .PVmodeclicknow {
            background-color: #f9ff9e;
        }
        .ulli {
            margin:0;
            padding:0;

        }
            .ulli li {
                list-style-type: none;

            }
                .ulli li a {
                    height: 100%;
                    display: block;
                    /*text-align: center;*/
                    font-size:18px;
                }
                .ulli li a:hover {
                    background-color: #37b0d1;
                    
                }


        ::-webkit-scrollbar-track {
            -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
            background-color: #F5F5F5;
        }

        ::-webkit-scrollbar {
            width: 10px;
            background-color: #F5F5F5;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #F90;
            background-image: -webkit-linear-gradient(90deg, rgba(255, 255, 255, .2) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, .2) 50%, rgba(255, 255, 255, .2) 75%, transparent 75%, transparent)
        }


        .radiusbtn {
            background: #fff08c;
            background-image: -webkit-linear-gradient(top, #fff08c, #ffc76e);
            background-image: -moz-linear-gradient(top, #fff08c, #ffc76e);
            background-image: -ms-linear-gradient(top, #fff08c, #ffc76e);
            background-image: -o-linear-gradient(top, #fff08c, #ffc76e);
            background-image: linear-gradient(to bottom, #fff08c, #ffc76e);
            -webkit-border-radius: 8px;
            -moz-border-radius: 8px;
            border-radius: 8px;
            border: solid #bccfdb 2px;
            text-decoration: none;
            color: #80949f;
        }
            .radiusbtn:hover {
                background: #f2faff;
                background-image: -webkit-linear-gradient(top, #f2faff, #baccd6);
                background-image: -moz-linear-gradient(top, #f2faff, #baccd6);
                background-image: -ms-linear-gradient(top, #f2faff, #baccd6);
                background-image: -o-linear-gradient(top, #f2faff, #baccd6);
                background-image: linear-gradient(to bottom, #f2faff, #baccd6);
                text-decoration: none;
                color: #ff8400;
            }

        .radiusbtn2 {
            -webkit-border-radius: 6px;
            -moz-border-radius: 6px;
            border-radius: 6px;
            border: solid #bccfdb 2px;
        }
            .radiusbtn2:hover {
                background: #f2faff;
                background-image: -webkit-linear-gradient(top, #f2faff, #baccd6);
                background-image: -moz-linear-gradient(top, #f2faff, #baccd6);
                background-image: -ms-linear-gradient(top, #f2faff, #baccd6);
                background-image: -o-linear-gradient(top, #f2faff, #baccd6);
                background-image: linear-gradient(to bottom, #f2faff, #baccd6);
                text-decoration: none;
                color: #e58224;
            }
        .radiusbtn3 {
            -webkit-border-radius: 6px;
            -moz-border-radius: 6px;
            border-radius: 6px;
            border: solid #bccfdb 2px;
        }

        select {
            -webkit-appearance: button;
            -moz-appearance: button;
            -webkit-user-select: none;
            -moz-user-select: none;
            -webkit-padding-end: 20px;
            -moz-padding-end: 20px;
            -webkit-padding-start: 2px;
            -moz-padding-start: 2px;
            background: #ffeac0;
            background-image: -webkit-linear-gradient(top, #E5E5E5, #F4F4F4); /* For Chrome and Safari */
            background-image: -moz-linear-gradient(top, #E5E5E5, #F4F4F4); /* For old Fx (3.6 to 15) */
            background-image: -ms-linear-gradient(top, #E5E5E5, #F4F4F4); /* For pre-releases of IE 10*/
            background-image: -o-linear-gradient(top, #E5E5E5, #F4F4F4); /* For old Opera (11.1 to 12.0) */
            background-image:  linear-gradient(to bottom, #E5E5E5, #F4F4F4); /* Standard syntax; must be last */
            background-position: center right;
            background-repeat: no-repeat;
            border: 1px solid #AAA;
            border-radius: 2px;
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1);
            color: #555;
            font-size: inherit;
            margin: 0;
            overflow: hidden;
            padding-top: 2px;
            padding-bottom: 2px;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

    </style>
}

<div id="SM">
    <div class="row" style="height:440px">
        <div class="col" id="tabs-1">
            <header>
                <nav>
                    <ul @*class="Menupage"*@>
                        <li><a href="#maintab-1-1">自選股</a></li>
                        <li><a href="#maintab-1-2">庫存股</a></li>
                        <li><a href="#maintab-1-3">上市</a></li>
                    </ul>
                </nav>
            </header>
            <article id="maintab-1-1"  style="padding:5px">
                <select id="mainDDL"  style="margin-left:5px" >
                    <option>請選擇</option>
                </select>
                <button id="LBssssetting" class="radiusbtn">編輯清單內容</button>
                <div style=" height: 355px; overflow-y: scroll; overflow-x: hidden;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">排序</th>
                                <th scope="col">股票代碼</th>
                                <th scope="col">股票名稱</th>
                                <th scope="col">買進</th>
                                <th scope="col">賣出</th>
                                <th scope="col">成交</th>
                                <th scope="col">漲跌</th>
                                <th scope="col">漲幅</th>
                                <th scope="col">單量</th>
                                <th scope="col">總量</th>
                            </tr>
                        </thead>
                        <tbody id="maintb"></tbody>
                    </table>
                </div>
            </article>

            <article id="maintab-1-2"  style="padding:5px">
                <select id="maintreasuryDDL" style="width:400px;margin-left:5px">
                    <option></option>
                </select>
                <div style=" height: 360px; overflow-y: scroll; overflow-x: hidden;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>股票代碼</th>
                                <th>股票名稱</th>
                                <th>價</th>
                                <th>量</th>
                                <th>損益</th>
                                <th>入庫時間</th>
                            </tr>
                        </thead>
                        <tbody id="maintbbytreasury" ></tbody>
                    </table>
                </div>
            </article>
            <article id="maintab-1-3" style="padding:5px">
                <select id="maincategoryDDL" style="margin-left:5px">
                    <option></option>
                </select>
                <div style=" height: 360px; overflow-y: scroll; overflow-x: hidden;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">股票代碼</th>
                                <th scope="col">股票名稱</th>
                                <th scope="col">買進</th>
                                <th scope="col">賣出</th>
                                <th scope="col">成交</th>
                                <th scope="col">漲跌</th>
                                <th scope="col">漲幅</th>
                                <th scope="col">單量</th>
                                <th scope="col">總量</th>
                            </tr>
                        </thead>
                        <tbody id="maintbbycategory"></tbody>
                    </table>
                </div>
            </article>
        </div>

        <div class="col" id="tabs-2">
            <header>
                <nav>
                    <ul @*class="Menupage"*@>
                        <li><a href="#maintab-2-1">加權指數</a></li>
                    </ul>
                </nav>
            </header>
            <article id="maintab-2-1" style="padding:5px">
                <div style="float: left;">
                    <div id="MarketTrendChart" style="border-top:1px solid black;border-left:1px solid black;border-right:1px solid black;width:910px;height:320px">
                    </div> 
                    <div id="MarketTrendChart2" style="border-bottom:1px solid black;border-left:1px solid black;border-right:1px solid black;width:910px;height:70px;padding-left:21px">
                    </div>       
                </div>
            </article>
        </div>
        <div class="w-100">
            @*<hr />
            列分隔
            <hr />*@
        </div>
        <div class="col" id="tabs-3">
            <header>
                <nav>
                    <ul @*class="Menupage"*@>
                        <li><a href="#maintab-3-1">個股走勢</a></li>
                        <li><a href="#maintab-3-2">技術分析</a></li>
                    </ul>
                </nav>
            </header>
            <article id="maintab-3-1" style="padding:5px">
                <div style="float: left;">
                    <div id="trendchart" style="border-top:1px solid black;border-left:1px solid black;border-right:1px solid black;width:630px;height:320px;padding-left:7px">
                    </div>
                    <div id="trendchart2" style="border-bottom:1px solid black;border-left:1px solid black;border-right:1px solid black;width:630px;height:70px">
                    </div>
                </div>
                <div style="float: right;">
                    <header>
                        <nav>
                            <ul class="Menupage">
                                @*<li>報價</li>
                                <li>明細</li>*@
                            </ul>
                        </nav>
                    </header>
                    <article>
                        @*<span>報價</span>*@
                        <table class="table" style="width:295px;margin-bottom:0">
                            <tbody id="trendchartinfo"  >
                             
                            </tbody>
                        </table>
                    </article>
                </div>
            </article>
            <article id="maintab-3-2" style="padding:5px">
                <div id="kline" style="border:1px solid black;width:918px;height:390px">
                </div>
            </article>
        </div>

        <div class="col" id="tabs-4">
            <header>
                <nav>
                    <ul @*class="Menupage"*@>
                        <li><a href="#maintab-4-1">下單</a></li>
                        <li><a href="#maintab-4-2">掛單</a></li>
                        <li><a href="#maintab-4-3">交易紀錄</a></li>
                    </ul>
                </nav>
            </header>
            <div style="height:390px" id="maintab-4-1" >
                    <header>
                        <nav>
                            <ul class="Menupage">
                                <li>證券</li>
                            </ul>
                        </nav>
                    </header>
                    <article style="height:310px">
                        <div>
                            <select id="stocktradeaccountid" style="width: 400px">
                                <option></option>
                            </select>
                            <input type="button" value="選擇帳戶" class="radiusbtn2"/>
                        </div>
                        <div style="margin-top:8px">
                            <input type="button" value="股票代碼" id="stockidfast" class="radiusbtn2"/>
                            <input type="text" style="width: 105px"  id="stockidfastid" class="radiusbtn3"/>
                            <input type="text" style="width: 175px"  id="stockidfastname" class="radiusbtn3"/>
                        </div>
                        <div  style="margin-top:8px">
                            <input type="button" value="整股" id="order_whole" style="width:50px" class="PVmode radiusbtn2" onclick="PV(event)" />
                            <input type="button" value="定價" id="order_fixprice" style="width:50px" class="PVmode radiusbtn2" onclick="PV(event)" />
                            <input type="button" value="零股" id="order_zero" style="width:50px" class="PVmode radiusbtn2" onclick="PV(event)" />
                            <input type="button" value="現" style="margin-left:29px;background-color:#f9ff9e;width:40px" class="radiusbtn2"/>
                            <input type="button" value="資" style="width:40px" disabled class="radiusbtn3"/>
                            <input type="button" value="券" style="width:40px" disabled class="radiusbtn3"/>
                        </div>
                        <div  style="margin-top:8px">
                            <input type="button" id="order_buystock" value="買進" style="width:50px" class="radiusbtn2"/>
                            <input type="button" id="order_soldstock" value="賣出" style="width:50px" class="radiusbtn2"/>
                        </div>
                        <div style="margin-left:12px;margin-top:6px">
                            <label id="thousandshare" >張數</label>
                            <input type="number" value="0" id="order_volume" min="0" style="width:140px;text-align: right;margin-left:16px" class="radiusbtn3" />
                            <input type="button" value="下單" id="placeanorder" style="width:140px"  class="radiusbtn2"/>
                        </div>
                        <div style="margin-left:12px;margin-top:6px">
                            <label>價格</label>
                            <input type="number" value="0" id="order_price" style="width: 140px;text-align: right;margin-left:16px" class="radiusbtn3" />
                            <input type="button" value="現" id="order_pricenow" style="width:40px" class="radiusbtn2"/>
                            <input type="button" value="漲" id="order_priceuplimit"  style="width:40px" class="radiusbtn2"/>
                            <input type="button" value="跌" id="order_pricedownlimit"  style="width:40px" class="radiusbtn2"/>
                        </div>
                        <div style="margin-left:5px;margin-top:6px">
                            <table >
                                <tr >
                                    <td><label>成本：</label></td>
                                    <td style="width:140px"><p class="text-right" style="margin-bottom:8px;padding-right:12px" id="EstimatedCost">NT$ 0.00</p></td>
                                </tr>
                            </table>
                        </div>
                    </article>
            </div>
            <div id="maintab-4-2">
                 <select id="ordercheckDDL">
                     <option value="0">掛單中</option>
                     <option value="1">已取消</option>
                </select>
                <div style=" height: 300px; overflow-y: scroll; overflow-x: hidden;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>單號</th>
                                <th>股票</th>
                                <th>買/賣</th>
                                <th>價</th>
                                <th>量</th>
                                <th>掛單時間</th>                                
                            </tr>
                        </thead>
                        <tbody id="pendingordertb"></tbody>
                    </table>
                </div>
            </div>
            <div id="maintab-4-3">
                <select id="strDDL">
                    <option value="1">今日</option>
                    <option value="7">過去七天</option>
                    <option value="30">過去三十天</option>
                </select>
                <div style=" height: 300px; overflow-y: scroll; overflow-x: hidden;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">單號</th>
                                <th scope="col">股票</th>
                                <th scope="col">買/賣</th>
                                <th scope="col">掛單價</th>
                                <th scope="col">成交價</th>
                                <th scope="col">量</th>
                                <th scope="col">掛單時間</th>
                                <th scope="col">入庫時間</th>
                                <th scope="col">帳戶</th>
                            </tr>
                        </thead>
                        <tbody id="stocktradingrecordtb"></tbody>
                    </table>
                </div>


            </div>
        </div>
    </div>
</div>



<div id="overlay">
    <div class="row" style="background-color:white;">
        <div class="col-1" style="background-color:rgba(0,0,0,0.75);"></div>

        <div class="col-1"></div>
        <div class="col-4">
            <div class="row">
                <fieldset style="border:1px solid black;width:100%">
                    <legend style="margin-bottom:5px">清單列</legend>
                    <div>
                        <select id="DDLsss2" style="margin-left:2px;margin-bottom:2px">
                            <option>1</option>
                        </select>
                        <button id="LBssss" class="radiusbtn"  style="margin-left:2px;">編輯清單</button>

                    </div>
                </fieldset>
            </div>
            <div class="row">
                <fieldset style="border: 1px solid black;width:100%">
                    <legend style="margin-bottom:5px">清單內容</legend>
                    <div style="width: 100%; height: 300px; overflow-y: scroll; overflow-x: hidden;">
                        <table class="table" id="Tablesss">
                            <thead>
                                <tr>
                                    <th>排序編號</th>
                                    <th>股票代碼</th>
                                    <th>股票名稱</th>
                                    <th>刪除</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </fieldset>
            </div>

        </div>
        <div class="col-3">
            <fieldset style="border:1px solid black">
                <legend>查詢股票</legend>
                <label style="margin: 0px 10px">股票代碼/名稱</label>
                <input type="text" id="TBsearchs" style="width: 150px" class="radiusbtn3"/>
                <button id="LBsearchs" class="radiusbtn">查詢</button>
                <div>
                    <select id="DDLscategory" style="margin-left:10px">
                        <option></option>
                    </select>
                </div>
                <div style="width: 100%; height: 300px; overflow-y: scroll; overflow-x: hidden;">
                    <table class="table" id="Tabsbysearcch">
                        <thead>
                            <tr>
                                <th>股票代碼</th>
                                <th>股票名稱</th>
                                <th>加入</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </fieldset>
        </div>
        <div class="col-1" style="padding-top:20px">
            <button id="LBbackstocktrade" class="radiusbtn2">返回大廳</button>
        </div>
        <div class="col-2" style="background-color:rgba(0,0,0,0.75);"></div>
    </div>
</div>


<div id="overlay2">
    <div class="row">
        <div class="col-3" style="width:200px;height:200px"></div>
        <div class="col-5" style="background-color:white;height:440px">
            <fieldset style="border:1px solid black;width:100%">
                <legend>編輯清單</legend>
                <div style="padding-left:30px;padding-right:10px;">
                    <div style="overflow-y: scroll;overflow-x:hidden;height:300px">
                        <table class="table" id="Tabssslist">
                            <thead>
                                <tr>
                                    <th>修改</th>
                                    <th>清單編號</th>
                                    <th>清單名稱</th>
                                    <th>刪除</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <br />
                    <div style="padding-bottom:5px">
                        <label style="margin-left:15px">新增清單</label>
                        <label id="LabelAddListofNumber" style="margin-left:8px">編號:0</label>
                        <input type="text" style="margin-left:75px" id="TextBoxAddListofName" class="radiusbtn3" />
                        <button id="LinkButtonAddNewList" class="radiusbtn" style="margin-left:8px">新增</button>
                        <br />                        
                        <button id="LBssssfinish" style="float:right" class="radiusbtn2">返回清單內容</button>
                    </div>

                </div>
            </fieldset>

        </div>
        <div class="col-4" style="width:200px;height:200px">

        </div>
    </div>
</div>

<div id="overlay3">
    <div class="row">
        <div class="col-3"></div>
        <div class="col-5" style="width:200px;height:200px">
            <fieldset style="width:100%">
                <legend style="color:white;font-size:32px">選取代碼</legend>
                    <div class="row">
                        <div class="col" id="accordioncategory" style="height:650px;overflow-y: scroll">

                        </div>
                    </div>
            </fieldset>
        </div>
        <div class="col-3">
            <button id="accordionback" style="float:left" class="radiusbtn2">返回大廳</button>
        </div>
    </div>
</div>


@section scripts{
    <script src="~/Scripts/date.f-0.5.0.js"></script>
    <script src="~/Scripts/Json4ms.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script>
        var mainDDL = $('#mainDDL');
        var maincategoryDDL = $('#maincategoryDDL');
        var DDLsss2 = $('#DDLsss2');
        var Tablesss = $('#Tablesss>tbody');
        var DDLscategory = $('#DDLscategory');
        var Tabsbysearch = $('#Tabsbysearcch>tbody');
        var Tabssslist = $('#Tabssslist>tbody');
        var LabelAddListofNumber = $('#LabelAddListofNumber');
        var TextBoxAddListofName = $('#TextBoxAddListofName');
        var LinkButtonAddNewList = $('#LinkButtonAddNewList');
        var TBsearchs = $('#TBsearchs');
        var LBsearchs = $('#LBsearchs');
        var maintb = $('#maintb');
        var pendingordertb = $('#pendingordertb');
        var ordercheckDDL = $('#ordercheckDDL');
        var stocktradingrecordtb = $('#stocktradingrecordtb');
        var strDDL = $('#strDDL');
        var accordioncategory = $("#accordioncategory");
        var stockidfastid = $('#stockidfastid');
        var trendchartinfo = $('#trendchartinfo');
        var stocktradeaccountid = $('#stocktradeaccountid');
        var maintreasuryDDL = $('#maintreasuryDDL');
        var order_buystock = $('#order_buystock');
        var thousandshare = $('#thousandshare');
        var order_priceuplimit = $('#order_priceuplimit');
        var order_pricedownlimit = $('#order_pricedownlimit');
        var order_pricenow = $('#order_pricenow');
        var order_soldstock = $('#order_soldstock');
        var order_price = $('#order_price');
        var order_volume = $('#order_volume')

        //初始載入起點------
        $(document).ready(function () {
            $('#SM')[0].parentNode.setAttribute("style", "padding-top:21px");


            //載入分頁
            $("#tabs-1").tabs({});
            $("#tabs-2").tabs({});
            $("#tabs-3").tabs({});
            $("#tabs-4").tabs({});

            //
            Tablesss.sortable({
                items: "tr"
            });




            //載入自選清單下拉列
            ListReload();

            //載入大廳股市表(自選)
            SSSMaintbReload();


            //載入大廳股市表(上市)
            $.getJSON('@Url.Action("MainStockbyCategory", "Stock")', { 'CategoryID': 1 }, function (datas) {
                var fragment = $(document.createDocumentFragment());
                $.each(datas, function (idx, s) {


                    var Yprice = s.SIH_Price;
                    var maxprice = (Yprice * 1.1).toFixed(2);
                    var minprice = (Yprice * 0.9).toFixed(2);
                    var highprice = Yprice;
                    var lowprice = Yprice;
                    var Nprice = Yprice;
                    var totalprice = 0;
                    var LiftUnit = 0;
                    var totalvolume = 0;

                    if (Yprice < 10)
                    { LiftUnit = 0.01; }
                    else if (Yprice >= 10 && Yprice < 50)
                    { LiftUnit = 0.05; }
                    else if (Yprice >= 50 && Yprice < 100)
                    { LiftUnit = 0.1; }
                    else if (Yprice >= 100 && Yprice < 500)
                    { LiftUnit = 0.5; }
                    else if (Yprice >= 500 && Yprice < 1000)
                    { LiftUnit = 1; }
                    else if (Yprice >= 1000)
                    { LiftUnit = 5; }




                    for (var i = 0; i < 3240; i++) {


                        var NewLU = Math.floor(Math.random() * (maxprice - minprice + 1))
                        var NewLU2 = parseFloat(NewLU) + parseFloat(minprice)


                        if (NewLU2 > Yprice) {
                            Nprice += LiftUnit;
                            if (Nprice > maxprice) {
                                Nprice -= LiftUnit;
                            }
                        }
                        if (NewLU2 < Yprice) {
                            Nprice -= LiftUnit;
                            if (Nprice < minprice) {
                                Nprice += LiftUnit;
                            }
                        }
                        if (NewLU2 == Yprice)
                        { Nprice = Nprice; }

                        if (Nprice > highprice)
                        { highprice = Nprice; }
                        if (Nprice < lowprice)
                        { lowprice = Nprice; }

                        totalprice += Nprice;
                        totalvolume += Math.floor(Math.random() * 5);


                    }

                    //昨收 s.SI_StockName

                    var cell1 = $('<td></td>').text(s.SI_StockID).attr({ name: 'btnchangestocktrend', onclick: 'btnchangestocktrend(event)' }).addClass('Developerbtn');
                    var cell2 = $('<td></td>').text(s.SI_StockName);
                    var cell3 = $('<td></td>'); //買進
                    var cell4 = $('<td></td>'); //賣出
                    var cell5 = $('<td></td>'); //成交
                    var cell6 = $('<td></td>'); //漲跌
                    var cell7 = $('<td></td>'); //漲幅

                    var cell8 = $('<td></td>'); //單量
                    var cell9 = $('<td></td>').text(Math.floor(Math.random() * totalvolume));


                    var r = Math.floor(Math.random() * 2);
                    var r2 = Math.floor(Math.random() *4)-2;

                    if (Nprice >= s.SIH_Price) {
                        var p5 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:red").appendTo(cell5);
                        var p6 = $('<p></p>').text( "▲" + (Nprice - Yprice).toFixed(2)).attr("style", "margin-bottom:0;color:red").appendTo(cell6);
                        var p7 = $('<p></p>').text( "+" + ((Nprice - Yprice).toFixed(2) / Yprice).toFixed(2) + "%").attr("style", "margin-bottom:0;color:red").appendTo(cell7);
                    }
                    else if (Nprice < s.SIH_Price)
                    {
                        var p5 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:green").appendTo(cell5);
                        var p6 = $('<p></p>').text("▼" + (Nprice - Yprice).toFixed(2)).attr("style", "margin-bottom:0;color:green").appendTo(cell6);
                        var p7 = $('<p></p>').text(((Nprice - Yprice).toFixed(2) / Yprice).toFixed(2) + "%").attr("style", "margin-bottom:0;color:green").appendTo(cell7);
                    }



                    if (r == 1)
                    {
                        if (Nprice.toFixed(2) >= s.SIH_Price) {
                            var p3 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:red").appendTo(cell3);
                        }
                        else if (Nprice.toFixed(2) < s.SIH_Price) {
                            var p3 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:green").appendTo(cell3);
                        }

                        var p4text = (Nprice + (LiftUnit * r2)).toFixed(2);
                        if (p4text >= s.SIH_Price) {
                            var p4 = $('<p></p>').text(p4text).attr("style", "margin-bottom:0;color:red").appendTo(cell4);
                        }
                        else if (p4text < s.SIH_Price) {
                            var p4 = $('<p></p>').text(p4text).attr("style", "margin-bottom:0;color:green").appendTo(cell4);
                        }


                        var p8 = $('<p></p>').text(Math.floor(Math.random() *8)+1).attr("style", "margin-bottom:0;color:red").appendTo(cell8);


                    }
                    else if (r == 0)
                    {
                        var p3text = (Nprice - (LiftUnit * r2)).toFixed(2)
                        if (p3text >= s.SIH_Price) {
                            var p3 = $('<p></p>').text(p3text).attr("style", "margin-bottom:0;color:red").appendTo(cell3);
                        }
                        else if (p3text < s.SIH_Price) {
                            var p3 = $('<p></p>').text(p3text).attr("style", "margin-bottom:0;color:green").appendTo(cell3);
                        }


                        if (Nprice.toFixed(2) >= s.SIH_Price) {
                            var p4 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:red").appendTo(cell4);
                        }
                        else if (Nprice.toFixed(2) < s.SIH_Price) {
                            var p4 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:green").appendTo(cell4);
                        }



                        var p8 = $('<p></p>').text(Math.floor(Math.random() * 8)+1).attr("style", "margin-bottom:0;color:green").appendTo(cell8);


                    }


                    var row = $('<tr></tr>').append([cell1, cell2, cell3, cell4, cell5, cell6, cell7, cell8, cell9]);
                    fragment.append(row);
                })
                $('#maintbbycategory').html(fragment);
            })

            //載入大廳股市表(庫存)
            StockTreasuryReload();

            //載入清單內容表(順序1)
            SSSListNumberReload();


            //載入股票類別列(大廳/搜尋清單)
            $.getJSON('@Url.Action("StockCategories_DDL_load", "Stock")', {}, function (datas) {
                DDLscategory.empty();
                maincategoryDDL.empty();
                $.each(datas, function (idx, categorieslist) {
                    $("<option></option>").text(categorieslist.SCL_CategoryName).val(categorieslist.SCL_CategoryID).appendTo(DDLscategory);
                    $("<option></option>").text(categorieslist.SCL_CategoryName).val(categorieslist.SCL_CategoryID).appendTo(maincategoryDDL);
                });
            });

            //載入股票初始篩選表
            $.getJSON('@Url.Action("StockbyCategories_Table_load", "Stock")', { 'CategoryID': 1 }, function (datas) {
                Tabsbysearch.empty();
                $.each(datas, function (idx, stockbycategory) {
                    var cell1 = $("<td></td>").text(stockbycategory.SI_StockID);
                    var cell2 = $("<td></td>").text(stockbycategory.SI_StockName);
                    var cell3 = $("<td></td>").text('加入').attr({ name: 'btnlistnumberadd', onclick: 'btnlistnumberadd(event)' }).addClass('tablebtn');
                    var row = $("<tr></tr>").append([cell1, cell2, cell3]).appendTo(Tabsbysearch);

                });
            });

            //載入自選清單編輯表
            $.getJSON('@Url.Action("SelfSelectedStockList_Table_load", "Stock")', {  }, function (datas) {
                Tabssslist.empty();
                $.each(datas, function (idx, ssslisttable) {
                    var cell1 = $("<td></td>").text('修改').attr({ name: 'btnlistnameupdate', onclick: 'btnlistnameupdate(event)' }).addClass('tablebtn');
                    var cell2 = $("<td></td>").text(ssslisttable.SSS_ListID);
                    var txtlistname = $("<input>").attr({ type: 'text', value: ssslisttable.SSS_ListName }).attr("class", "radiusbtn3");
                    var cell3 = $("<td></td>").append(txtlistname);
                    var cell4 = $("<td></td>").text('刪除').attr({ name: 'btnlistdel', onclick: 'btnlistdel(event)' }).addClass('tablebtn');

                    var row = $("<tr></tr>").append([cell1, cell2, cell3, cell4]).appendTo(Tabssslist);

                });
            });



            //載入交易紀錄表
            STRReload();


            //載入快速搜尋代碼類股
            $.getJSON('@Url.Action("Category_Accordion_Load","Stock")', function (datas) {
                $.each(datas, function (idx, value) {
                    var div = $('<div></div>');
                    var h3 = $('<h3></h3>').text(value.Key);
                    var ul = $('<ul></ul>').addClass('ulli');

                    $.each(value.items, function (idx2, value2) {
                        var s = "(" + value2.SI_StockID + ")" + value2.SI_StockName;
                        var a = $('<a></a>').text(s);
                        var li = $('<li></li>').val(value2.SI_StockID).append(a).appendTo(ul);
                    })
                    ul.appendTo(div);
                    h3.appendTo(accordioncategory);
                    div.appendTo(accordioncategory);
                });

                accordioncategory.accordion({
                    heightStyle: "content",
                    collapsible: true
                });
            });

            //載入交易帳戶
            $.getJSON('@Url.Action("AccountID_Load","Stock")', function (datas) {
                stocktradeaccountid.empty();
                maintreasuryDDL.empty();
                $('<option></option>').text(datas).appendTo(stocktradeaccountid);
                $('<option></option>').text(datas).appendTo(maintreasuryDDL);

                //載入掛單紀錄表
                POHReload(datas);


            });


            //載入個股走勢資訊
            $.getJSON('@Url.Action("trendchart_select", "Stock")', { 'Stock': 1101 }, function (datas) {
                trendchartinfo.empty();

                var Yprice = datas.SIH_Price;
                var maxprice = (Yprice * 1.1).toFixed(2);
                var minprice = (Yprice * 0.9).toFixed(2);
                var highprice = Yprice;
                var lowprice = Yprice;
                var Nprice = Yprice;
                var v = Math.floor(Math.random() * (5000));
                var totalprice = 0;
                var LiftUnit = 0;

                if (Yprice < 10)
                { LiftUnit = 0.01; }
                else if (Yprice >= 10 && Yprice < 50)
                { LiftUnit = 0.05; }
                else if (Yprice >= 50 && Yprice < 100)
                { LiftUnit = 0.1; }
                else if (Yprice >= 100 && Yprice < 500)
                { LiftUnit = 0.5; }
                else if (Yprice >= 500 && Yprice < 1000)
                { LiftUnit = 1; }
                else if (Yprice >= 1000)
                { LiftUnit = 5; }

                for (var i = 0; i < 3240; i++) {


                    var NewLU = Math.floor(Math.random() * (maxprice - minprice + 1))
                    var NewLU2 = parseFloat(NewLU) + parseFloat(minprice)


                    if (NewLU2 > Yprice) {
                        Nprice += LiftUnit;
                        if (Nprice > maxprice) {
                            Nprice -= LiftUnit;
                        }
                    }
                    if (NewLU2 < Yprice) {
                        Nprice -= LiftUnit;
                        if (Nprice < minprice) {
                            Nprice += LiftUnit;
                        }
                    }
                    if (NewLU2 == Yprice)
                    { Nprice = Nprice; }

                    if (Nprice > highprice)
                    { highprice = Nprice; }
                    if (Nprice < lowprice)
                    { lowprice = Nprice; }

                    totalprice += Nprice;
                }


                var cell1 = $('<td></td>').text("成交");
                var cell2 = $('<td></td>');
                if (Nprice.toFixed(2) > Yprice)
                {
                    var p2 = $('<p></p>').text(Nprice.toFixed(2)).appendTo(cell2).attr( "style","margin-bottom:0;color:red");
                }
                if (Nprice.toFixed(2) <= Yprice)
                {
                    var p2 = $('<p></p>').text(Nprice.toFixed(2)).appendTo(cell2).attr("style", "margin-bottom:0;color:green");
                }

                var cell3 = $('<td></td>').text("時間");
                var cell4 = $('<td></td>').text("13:30:00");
                var row1 = $("<tr></tr>").append([cell1, cell2, cell3, cell4]).appendTo(trendchartinfo);

                var cell5 = $('<td></td>').text("漲跌");
                var cell6 = $('<td></td>');
                if((Nprice - Yprice).toFixed(2) > 0)
                {
                    var p6 = $('<p></p>').text((Nprice - Yprice).toFixed(2)).appendTo(cell6).attr("style", "margin-bottom:0;color:red");
                }
                if((Nprice - Yprice).toFixed(2) <= 0)
                {
                    var p6 = $('<p></p>').text((Nprice - Yprice).toFixed(2)).appendTo(cell6).attr("style", "margin-bottom:0;color:green");
                }
                var cell7 = $('<td></td>').text("單量");
                var cell8 = $('<td></td>').text(Math.floor(Math.random() * (30)));
                var row2 = $("<tr></tr>").append([cell5, cell6, cell7, cell8]).appendTo(trendchartinfo);

                var cell9 = $('<td></td>').text("漲跌幅");
                var cell10 = $('<td></td>');
                if ((Math.round(((Nprice - Yprice) / Yprice) * 100) / 100) > 0)
                {
                    var p10 = $('<p></p>').text(Math.round(((Nprice - Yprice) / Yprice) * 100) / 100 + "%").appendTo(cell10).attr("style", "margin-bottom:0;color:red");
                }
                if ((Math.round(((Nprice - Yprice) / Yprice) * 100) / 100) <= 0)
                {
                    var p10 = $('<p></p>').text(Math.round(((Nprice - Yprice) / Yprice) * 100) / 100 + "%").appendTo(cell10).attr("style", "margin-bottom:0;color:green");
                }
                var cell11 = $('<td></td>').text("總量");
                var cell12 = $('<td></td>').text(v);
                var row3 = $("<tr></tr>").append([cell9, cell10, cell11, cell12]).appendTo(trendchartinfo);

                var cell13 = $('<td></td>').text("最高");
                var cell14 = $('<td></td>');
                if (highprice.toFixed(2) > Yprice)
                {
                    var p14 = $('<p></p>').text(highprice.toFixed(2)).appendTo(cell14).attr("style", "margin-bottom:0;color:red");
                }
                if (highprice.toFixed(2) <= Yprice)
                {
                    var p14 = $('<p></p>').text(highprice.toFixed(2)).appendTo(cell14).attr("style", "margin-bottom:0;color:green");
                }
                var cell15 = $('<td></td>').text("昨量");
                var cell16 = $('<td></td>').text(Math.floor(Math.random() * (5000)));
                var row4 = $("<tr></tr>").append([cell13, cell14, cell15, cell16]).appendTo(trendchartinfo);

                var cell17 = $('<td></td>').text("最低");
                var cell18 = $('<td></td>');
                if (lowprice.toFixed(2) > Yprice)
                {
                    var p18 = $('<p></p>').text(lowprice.toFixed(2)).appendTo(cell18).attr("style", "margin-bottom:0;color:red");
                }
                if (lowprice.toFixed(2) <= Yprice)
                {
                    var p18 = $('<p></p>').text(lowprice.toFixed(2)).appendTo(cell18).attr("style", "margin-bottom:0;color:green");
                }
                var cell19 = $('<td></td>').text("昨收");
                var cell20 = $('<td></td>').text(Yprice);
                var row5 = $("<tr></tr>").append([cell17, cell18, cell19, cell20]).appendTo(trendchartinfo);

                var cell21 = $('<td></td>').text("均價");
                var cell22 = $('<td></td>');
                if ((totalprice / 3240).toFixed(2) > Yprice) {
                    var p22 = $('<p></p>').text((totalprice / 3240).toFixed(2)).appendTo(cell22).attr("style", "margin-bottom:0;color:red");
                }
                if ((totalprice / 3240).toFixed(2) <= Yprice) {
                    var p22 = $('<p></p>').text((totalprice / 3240).toFixed(2)).appendTo(cell22).attr("style", "margin-bottom:0;color:green");
                }
                var cell23 = $('<td></td>').text("開盤");
                var cell24 = $('<td></td>').text(Yprice);
                var row6 = $("<tr></tr>").append([cell21, cell22, cell23, cell24]).appendTo(trendchartinfo);

                var cell25 = $('<td></td>').text("振幅");
                var cell26 = $('<td></td>').text(Math.round(((highprice - lowprice) / Yprice) * 100) / 100);
                var cell27 = $('<td></td>').attr("style","padding-left:5px;padding-right:0px");
                var p27 = $('<p></p>').text("成交值").appendTo(cell27).attr("style", "");
                var cell28 = $('<td></td>').text((2 * (Math.random() * 3).toFixed(2))  + "億");
                var row7 = $("<tr></tr>").append([cell25, cell26, cell27, cell28]).appendTo(trendchartinfo);


            });


        })
        //初始載入結束



        //重新載入區起點------
        //重新載入自選股大廳顯示
         function SSSMaintbReload() {
                  $.getJSON('@Url.Action("MainStockbySSS", "Stock")', { 'ListID': 1 }, function (datas) {
                var fragment = $(document.createDocumentFragment());
                $.each(datas, function (idx, s) {

                    var Yprice = s.SIH_Price;
                    var maxprice = (Yprice * 1.1).toFixed(2);
                    var minprice = (Yprice * 0.9).toFixed(2);
                    var highprice = Yprice;
                    var lowprice = Yprice;
                    var Nprice = Yprice;
                    var totalprice = 0;
                    var LiftUnit = 0;
                    var totalvolume = 0;

                    if (Yprice < 10)
                    { LiftUnit = 0.01; }
                    else if (Yprice >= 10 && Yprice < 50)
                    { LiftUnit = 0.05; }
                    else if (Yprice >= 50 && Yprice < 100)
                    { LiftUnit = 0.1; }
                    else if (Yprice >= 100 && Yprice < 500)
                    { LiftUnit = 0.5; }
                    else if (Yprice >= 500 && Yprice < 1000)
                    { LiftUnit = 1; }
                    else if (Yprice >= 1000)
                    { LiftUnit = 5; }




                    for (var i = 0; i < 3240; i++) {


                        var NewLU = Math.floor(Math.random() * (maxprice - minprice + 1))
                        var NewLU2 = parseFloat(NewLU) + parseFloat(minprice)


                        if (NewLU2 > Yprice) {
                            Nprice += LiftUnit;
                            if (Nprice > maxprice) {
                                Nprice -= LiftUnit;
                            }
                        }
                        if (NewLU2 < Yprice) {
                            Nprice -= LiftUnit;
                            if (Nprice < minprice) {
                                Nprice += LiftUnit;
                            }
                        }
                        if (NewLU2 == Yprice)
                        { Nprice = Nprice; }

                        if (Nprice > highprice)
                        { highprice = Nprice; }
                        if (Nprice < lowprice)
                        { lowprice = Nprice; }

                        totalprice += Nprice;
                        totalvolume += Math.floor(Math.random() * 5);


                    }

                    //昨收 s.SI_StockName

                    var cell1 = $('<td></td>').text(s.SSS_ListNumberID);
                    var cell2 = $('<td></td>').text(s.SI_StockID).attr({ name: 'btnchangestocktrend', onclick: 'btnchangestocktrend(event)' }).addClass('Developerbtn');
                    var cell3 = $('<td></td>').text(s.SI_StockName);
                    var cell4 = $('<td></td>'); //買進
                    var cell5 = $('<td></td>'); //賣出
                    var cell6 = $('<td></td>'); //成交
                    var cell7 = $('<td></td>'); //漲跌
                    var cell8 = $('<td></td>'); //漲幅

                    var cell9 = $('<td></td>'); //單量
                    var cell10 = $('<td></td>').text(Math.floor(Math.random() * totalvolume));


                    var r = Math.floor(Math.random() * 2);
                    var r2 = Math.floor(Math.random() * 4) - 2;

                    if (Nprice >= s.SIH_Price) {
                        var p6 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:red").appendTo(cell6);
                        var p7 = $('<p></p>').text("▲" + (Nprice - Yprice).toFixed(2)).attr("style", "margin-bottom:0;color:red").appendTo(cell7);
                        var p8 = $('<p></p>').text("+" + ((Nprice - Yprice).toFixed(2) / Yprice).toFixed(2) + "%").attr("style", "margin-bottom:0;color:red").appendTo(cell8);
                    }
                    else if (Nprice < s.SIH_Price) {
                        var p6 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:green").appendTo(cell6);
                        var p7 = $('<p></p>').text("▼" + (Nprice - Yprice).toFixed(2)).attr("style", "margin-bottom:0;color:green").appendTo(cell7);
                        var p8 = $('<p></p>').text(((Nprice - Yprice).toFixed(2) / Yprice).toFixed(2) + "%").attr("style", "margin-bottom:0;color:green").appendTo(cell8);
                    }



                    if (r == 1) {
                        if (Nprice.toFixed(2) >= s.SIH_Price) {
                            var p4 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:red").appendTo(cell4);
                        }
                        else if (Nprice.toFixed(2) < s.SIH_Price) {
                            var p4 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:green").appendTo(cell4);
                        }

                        var p5text = (Nprice + (LiftUnit * r2)).toFixed(2);
                        if (p5text >= s.SIH_Price) {
                            var p5 = $('<p></p>').text(p5text).attr("style", "margin-bottom:0;color:red").appendTo(cell5);
                        }
                        else if (p5text < s.SIH_Price) {
                            var p5 = $('<p></p>').text(p5text).attr("style", "margin-bottom:0;color:green").appendTo(cell5);
                        }


                        var p9 = $('<p></p>').text(Math.floor(Math.random() * 8) + 1).attr("style", "margin-bottom:0;color:red").appendTo(cell9);


                    }
                    else if (r == 0)
                    {
                        var p4text = (Nprice - (LiftUnit * r2)).toFixed(2)
                        if (p4text >= s.SIH_Price) {
                            var p4 = $('<p></p>').text(p4text).attr("style", "margin-bottom:0;color:red").appendTo(cell4);
                        }
                        else if (p4text < s.SIH_Price) {
                            var p4 = $('<p></p>').text(p4text).attr("style", "margin-bottom:0;color:green").appendTo(cell4);
                        }

                        if (Nprice.toFixed(2) >= s.SIH_Price) {
                            var p5 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:red").appendTo(cell5);
                        }
                        else if (Nprice.toFixed(2) < s.SIH_Price) {
                            var p5 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:green").appendTo(cell5);
                        }


                        var p9 = $('<p></p>').text(Math.floor(Math.random() * 8) + 1).attr("style", "margin-bottom:0;color:green").appendTo(cell9);

                    }


                    var row = $('<tr></tr>').append([cell1, cell2, cell3, cell4, cell5, cell6, cell7, cell8, cell9, cell10]);


                    fragment.append(row);
                })
                $('#maintb').html(fragment);
            })
            }


        //重新載入自選清單下拉列
        function ListReload() {
            $.getJSON('@Url.Action("SelfSelectedStockList_DDL_load", "Stock")', {  }, function (datas) {
                    DDLsss2.empty();
                    mainDDL.empty();
                    $.each(datas, function (idx, ssslist) {
                        $("<option></option>").text(ssslist.SSS_ListName).val(ssslist.SSS_ListID).appendTo(DDLsss2);
                        $("<option></option>").text(ssslist.SSS_ListName).val(ssslist.SSS_ListID).appendTo(mainDDL);
                    });
                });
        }

        //重新載入交易紀錄
        function STRReload() {
            $.getJSON('@Url.Action("StockTradingRecord_load", "Stock")', {  'Day': $('#strDDL option:selected').val()}, function (datas) {
                stocktradingrecordtb.empty();
                $.each(datas, function (idx, stocktradingrecord) {
                    var cell1 = $("<td></td>").text(stocktradingrecord.STR_ID);
                    var cell2 = $("<td></td>")
                    var span2_1 = $("<span></span>").text(stocktradingrecord.SI_StockName).appendTo(cell2);
                    var br2 = $("<br />").appendTo(cell2);
                    var span2_2 = $("<span></span>").text("(" + stocktradingrecord.STR_StockID + ")").appendTo(cell2);

                    var cell3p = $("<p></p>").text(stocktradingrecord.STR_BuySold);
                    var cell3 = $("<td></td>").html(cell3p);
                    if (stocktradingrecord.STR_BuySold == "買") {
                        $(cell3[0].childNodes[0]).css({ "color": "red", "margin": 0 });
                    }
                    else if (stocktradingrecord.STR_BuySold == "賣") {
                        $(cell3[0].childNodes[0]).css({ "color": "green", "margin": 0 });
                    }
                    var cell4 = $("<td></td>").text(stocktradingrecord.STR_OrderPrice);
                    var cell5 = $("<td></td>").text(stocktradingrecord.STR_Price);
                    var cell6 = $("<td></td>").text(stocktradingrecord.STR_Volume);
                    var cell7 = $("<td></td>").text(JSON.parseWithDate(JSON.stringifyWcf(stocktradingrecord.STR_OrderTime)).f("yyyy-MM-dd HH:mm:ss"));
                    var cell8 = $("<td></td>").text(JSON.parseWithDate(JSON.stringifyWcf(stocktradingrecord.STR_STR_EnterTreasuryTime)).f("yyyy-MM-dd HH:mm:ss"));
                    var span = $("<span></span>").text(stocktradingrecord.STR_AccountID).attr({ "style": "display:inline-block;width:75px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;", "title":"交易帳戶：" + stocktradingrecord.STR_AccountID})
                    var cell9 = $("<td></td>").append(span);


                    var row = $("<tr></tr>").append([cell1, cell2, cell3, cell4, cell5, cell6, cell7, cell8, cell9]).appendTo(stocktradingrecordtb);

                });
            });
        }

        //重新載入交易介面價格
        function STPReload() {
            var LiftUnit = 0.00;
            $.getJSON('@Url.Action("StockTrade_Price_load", "Stock")', { 'StockID': $(stockidfastid).val()  }, function (Yprice) {
                var maxp = 1.1 * Yprice;
                var minp = 0.9 * Yprice;

                if (Yprice < 10)
                { LiftUnit = 0.01; }
                else if (Yprice >= 10 && Yprice < 50)
                { LiftUnit = 0.05; }
                else if (Yprice >= 50 && Yprice < 100)
                { LiftUnit = 0.1; }
                else if (Yprice >= 100 && Yprice < 500)
                { LiftUnit = 0.5; }
                else if (Yprice >= 500 && Yprice < 1000)
                { LiftUnit = 1; }
                else if (Yprice >= 1000)
                { LiftUnit = 5; }

                var maxp = Math.ceil((1.1 * Yprice) / LiftUnit) * LiftUnit;
                maxp =  maxp.toFixed(2);
                var minp = Math.floor((0.9 * Yprice) / LiftUnit) * LiftUnit;
                minp = minp.toFixed(2);
                order_price.val(Yprice).attr({ "step": LiftUnit, "max": maxp, "min": minp });
            })
        }

        //重新載入庫存股
        function StockTreasuryReload() {
            $.getJSON('@Url.Action("MainTreasuryStock_Table_load", "Stock")', { 'AC': $('#maintreasuryDDL option:selected').val() }, function (datas) {
                var fragment = $(document.createDocumentFragment());
                $.each(datas, function (idx, s) {
                    var cell1 = $('<td></td>').text(s.ST_StockID).attr({ name: 'btnchangestocktrend', onclick: 'btnchangestocktrend(event)' }).addClass('Developerbtn');
                    var cell2 = $('<td></td>').text(s.SI_StockName);
                    var cell3 = $('<td></td>').text(s.ST_Price);
                    var cell4 = $('<td></td>').text(s.ST_Volume);

                    var calc = (s.SIH_Price - s.ST_Price) * (s.ST_Volume) * 1000;
                    var cell5 = $('<td></td>').text(calc.toFixed(2));
                    if (calc >= 0) {
                        cell5.attr("style", "color:limegreen");
                    }
                    else if (calc < 0) {
                        cell5.attr("style", "color:red");
                    }
                   

                    var cell6 = $('<td></td>').text(JSON.parseWithDate(JSON.stringifyWcf(s.ST_EnterTreasuryTime)).f("yyyy-MM-dd")); //HH:mm:ss

                    var row = $('<tr></tr>').append([cell1, cell2, cell3, cell4, cell5, cell6]);
                    fragment.append(row);
                })
                $('#maintbbytreasury').html(fragment);
            })
        }

        //重新載入掛單紀錄表
        function POHReload(AC) {
            $.getJSON('@Url.Action("PendingOrderHistory_Table_load", "Stock")', { 'AC': AC, 'Check': 0 }, function (datas) {
                pendingordertb.empty();
                $.each(datas, function (idx, order) {
                    var cell1 = $("<td></td>").text(order.POH_ID);
                    var cell2 = $("<td></td>").text(order.SI_StockName + "(" + order.POH_StockID + ")");
                    var cell3p = $("<p></p>").text(order.POH_BuySold);
                    var cell3 = $("<td></td>").html(cell3p);
                    if (order.POH_BuySold == "買")
                    {
                        $(cell3[0].childNodes[0]).css({ "color":"red","margin":0});
                    }
                    else if (order.POH_BuySold == "賣")
                    {
                        $(cell3[0].childNodes[0]).css({ "color": "green", "margin": 0 });
                    }
                    var cell4 = $("<td></td>").text(order.POH_Price);
                    var cell5 = $("<td></td>").text(order.POH_Volume);
                    var cell6 = $("<td></td>").text(JSON.parseWithDate(JSON.stringifyWcf(order.POH_OrderTime)).f("yyyy-MM-dd HH:mm:ss"));
                    var cell7 = $("<td></td>").text('取消掛單').attr({ name: 'btnpendingordercancel', onclick: 'btnpendingordercancel(event)' }).addClass('tablebtn');
                    var cell8 = $("<td></td>").text('交易完成鈕').attr({ name: 'btnupdatetostocktrade', onclick: 'btnupdatetostocktrade(event)', }).addClass('Developerbtn');


                    var row = $("<tr></tr>").append([cell1, cell2, cell3, cell4, cell5, cell6, cell7, cell8]).appendTo(pendingordertb);

                });
            });
        }

        //重新載入清單(1)內容
        function SSSListNumberReload() {
                $.getJSON('@Url.Action("SelfSelectedStockListNumber_Table_load", "Stock")', { 'ListID': 1 }, function (datas) {
                    Tablesss.empty();
                    $.each(datas, function (idx, ssslistnumber) {
                        var cell1 = $("<td></td>").text(ssslistnumber.SSS_ListNumberID);
                        var cell2 = $("<td></td>").text(ssslistnumber.SSS_StockID);
                        var cell3 = $("<td></td>").text(ssslistnumber.SI_StockName);
                        var cell4 = $("<td></td>").text('刪除').attr({ name: 'btnlistnumberdel', onclick: 'btnlistnumberdel(event)' }).addClass('tablebtn');
                        var row = $("<tr></tr>").append([cell1, cell2, cell3, cell4]).appendTo(Tablesss);
                    });
                });
            }


        //表格動作起點------
         //自選清單內容_新增事件
        function btnlistnumberadd(event) {
            var findstockid = event.path[1].childNodes[0].childNodes[0].textContent; //找出stockid
            var findstockname = event.path[1].childNodes[1].childNodes[0].textContent;
            //event. 滑鼠事件
            //path[1]. 抓出點擊的列
            //childNodes[0]. [0] => TABLE第0欄  (可改0123....)
            //childNodes[0]. [0] => 抓到欄內cell
            //textContent  讀取欄內內容(也可用data value.......詳細用上一層看)
            var findlist = $('#DDLsss2 option:selected').val(); //找出自選清單編號
            var beforecount = Tablesss[0].childNodes.length;
            $.getJSON('@Url.Action("SelfSelectedStockListNumber_Table_Add","Stock")', { 'ListID': findlist, 'StockID': findstockid }, function (datas) {
                Tablesss.empty();
                $.each(datas, function (idx, ssslistnumber) {
                    var cell1 = $("<td></td>").text(ssslistnumber.SSS_ListNumberID);
                    var cell2 = $("<td></td>").text(ssslistnumber.SSS_StockID);
                    var cell3 = $("<td></td>").text(ssslistnumber.SI_StockName);
                    var cell4 = $("<td></td>").text('刪除').attr({ name: 'btnlistnumberdel', onclick: 'btnlistnumberdel(event)' }).addClass('tablebtn');
                    var row = $("<tr></tr>").append([cell1, cell2, cell3, cell4]).appendTo(Tablesss);
                });
            }).done(function () {
                var aftercount = Tablesss[0].childNodes.length;

                if (beforecount != aftercount)
                {
                    alert(findstockname + "(" + findstockid + ")<br/>成功加入清單!!");
                }
                else if (beforecount == aftercount)
                {
                    alert(findstockname + "(" + findstockid + ")<br/>已存在自選內容<br/>不得重複加入!!");
                }

                });
           
           
        }

        //自選清單內容_刪除事件
        function btnlistnumberdel(event) {
            var findrow = event.path[1].childNodes[0].childNodes[0].textContent; //找出點擊的清單內容第幾列
            //event. 滑鼠事件
            //path[1]. 抓出點擊的列
            //childNodes[0]. [0] => TABLE第0欄  (可改0123....)
            //childNodes[0]. [0] => 抓到欄內cell
            //textContent  讀取欄內內容(也可用data value.......詳細用上一層看)
            var findlist = $('#DDLsss2 option:selected').val(); //找出自選清單編號

            $.getJSON('@Url.Action("SelfSelectedStockListNumber_Table_Del", "Stock")', { 'ListID': findlist, 'ListNumberID': findrow }, function (datas) {
                Tablesss.empty();
                $.each(datas, function (idx, ssslistnumber) {
                    var cell1 = $("<td></td>").text(ssslistnumber.SSS_ListNumberID);
                    var cell2 = $("<td></td>").text(ssslistnumber.SSS_StockID);
                    var cell3 = $("<td></td>").text(ssslistnumber.SI_StockName);
                    var cell4 = $("<td></td>").text('刪除').attr({ name: 'btnlistnumberdel', onclick: 'btnlistnumberdel(event)' }).addClass('tablebtn');
                    var row = $("<tr></tr>").append([cell1, cell2, cell3, cell4]).appendTo(Tablesss);

                });
            });
            alert("刪除成功");
        };

        //自選清單內容_排序變更事件
        var or;
        Tablesss.on("sortactivate", function (event, ui) {
            or = ui.item[0].rowIndex;
        });
        var nr;
        Tablesss.on("sortbeforestop", function (event, ui) {
            nr = ui.item[0].rowIndex;
        });


        Tablesss.on("sortbeforestop", function (event, ui) {
            var findlist = $('#DDLsss2 option:selected').val();
            $.getJSON('@Url.Action("SelfSelectedStockListNumber_Table_ChangeID", "Stock")', {  'ListID': findlist, 'or': or, 'nr': nr }, function (datas) {
                Tablesss.empty();
                $.each(datas, function (idx, ssslistnumber) {
                    var cell1 = $("<td></td>").text(ssslistnumber.SSS_ListNumberID);
                    var cell2 = $("<td></td>").text(ssslistnumber.SSS_StockID);
                    var cell3 = $("<td></td>").text(ssslistnumber.SI_StockName);
                    var cell4 = $("<td></td>").text('刪除').attr({ name: 'btnlistnumberdel', onclick: 'btnlistnumberdel(event)' }).addClass('tablebtn');
                    var row = $("<tr></tr>").append([cell1, cell2, cell3, cell4]).appendTo(Tablesss);
                });
                alert("排序變更成功");
            });
        });


        //自選清單_新增事件
        $(LinkButtonAddNewList).on('click', function (event) {
            event.preventDefault();

            var sssNewListID = Tabssslist[0].rows.length + 1;//取出新增的欄位編號
            var sssNewListName = $(TextBoxAddListofName).val(); //取出新增的欄位名稱

            $.getJSON('@Url.Action("SelfSelectedStockList_Table_Add","Stock")', {  'ListID': sssNewListID, 'ListName': sssNewListName }, function (datas) {
                Tabssslist.empty();
                $.each(datas, function (idx, ssslisttable) {
                    var cell1 = $("<td></td>").text('修改').attr({ name: 'btnlistnameupdate', onclick: 'btnlistnameupdate(event)' }).addClass('tablebtn');
                    var cell2 = $("<td></td>").text(ssslisttable.SSS_ListID);
                    var txtlistname = $("<input>").attr({ type: 'text', value: ssslisttable.SSS_ListName });
                    var cell3 = $("<td></td>").append(txtlistname);
                    var cell4 = $("<td></td>").text('刪除').attr({ name: 'btnlistdel', onclick: 'btnlistdel(event)' }).addClass('tablebtn');

                    var row = $("<tr></tr>").append([cell1, cell2, cell3, cell4]).appendTo(Tabssslist);
                });
                var newid = sssNewListID + 1;
                LabelAddListofNumber.text("編號:" + newid);
                $(TextBoxAddListofName).val('');
                ListReload();
                alert("加入成功");
            });
        });

        //自選清單_刪除事件(先刪除再更新ID排序)
        function btnlistdel(event) {
            var listid = event.path[1].childNodes[1].childNodes[0].textContent;
            var listname = event.path[1].childNodes[2].childNodes[0].value;

            $.getJSON('@Url.Action("SelfSelectedStockList_Table_Del","Stock")', { 'ListID': listid, }, function (datas) {
                Tabssslist.empty();
                $.each(datas, function (idx, ssslisttable) {
                    var cell1 = $("<td></td>").text('修改').attr({ name: 'btnlistnameupdate', onclick: 'btnlistnameupdate(event)' }).addClass('tablebtn');
                    var cell2 = $("<td></td>").text(ssslisttable.SSS_ListID);
                    //var txtlistid = $("<input>").attr({ type: 'text', value: ssslisttable.ListID });
                    //var cell2 = $("<td></td>").append(txtlistid);
                    var txtlistname = $("<input>").attr({ type: 'text', value: ssslisttable.SSS_ListName });
                    var cell3 = $("<td></td>").append(txtlistname);
                    var cell4 = $("<td></td>").text('刪除').attr({ name: 'btnlistdel', onclick: 'btnlistdel(event)' }).addClass('tablebtn');

                    var row = $("<tr></tr>").append([cell1, cell2, cell3, cell4]).appendTo(Tabssslist);
                    ListReload();
                });
            });
            var n = Tabssslist[0].rows.length;  //調整新增處顯示的最新數字
            LabelAddListofNumber.text("編號:" + n);
            alert("刪除成功");

            SSSListNumberReload();
        }

        //自選清單_更名事件
        function btnlistnameupdate(event) {
            var listid = event.path[1].childNodes[1].childNodes[0].textContent;
            var listname = event.path[1].childNodes[2].childNodes[0].value;

            $.getJSON('@Url.Action("SelfSelectedStockList_Table_Update","Stock")', { 'ListID': listid, 'ListName': listname }, function (datas) {
                Tabssslist.empty();
                $.each(datas, function (idx, ssslisttable) {
                    var cell1 = $("<td></td>").text('修改').attr({ name: 'btnlistnameupdate', onclick: 'btnlistnameupdate(event)' }).addClass('tablebtn');
                    var cell2 = $("<td></td>").text(ssslisttable.SSS_ListID);
                    //var txtlistid = $("<input>").attr({ type: 'text', value: ssslisttable.ListID });
                    //var cell2 = $("<td></td>").append(txtlistid);
                    var txtlistname = $("<input>").attr({ type: 'text', value: ssslisttable.SSS_ListName });
                    var cell3 = $("<td></td>").append(txtlistname);
                    var cell4 = $("<td></td>").text('刪除').attr({ name: 'btnlistdel', onclick: 'btnlistdel(event)' }).addClass('tablebtn');

                    var row = $("<tr></tr>").append([cell1, cell2, cell3, cell4]).appendTo(Tabssslist);
                    ListReload();
                });
            });
            alert("修改成功");
        };

        //自選清單DDL_option改變事件
        DDLsss2.change(function () {
            var lv = DDLsss2.val();
            $.getJSON('@Url.Action("SelfSelectedStockListNumber_Table_load","Stock")', { 'ListID': lv }, function (datas) {
                Tablesss.empty();
                $.each(datas, function (idx, ssslistnumber) {
                    var cell1 = $("<td></td>").text(ssslistnumber.SSS_ListNumberID);
                    var cell2 = $("<td></td>").text(ssslistnumber.SSS_StockID);
                    var cell3 = $("<td></td>").text(ssslistnumber.SI_StockName);
                    var cell4 = $("<td></td>").text('刪除').attr({ name: 'btnlistnumberdel', onclick: 'btnlistnumberdel(event)' }).addClass('tablebtn');
                    var row = $("<tr></tr>").append([cell1, cell2, cell3, cell4]).appendTo(Tablesss);
                });
            });
        });

        //股票類別DDL_option改變事件
        DDLscategory.change(function () {
            var lvc = DDLscategory.val();
            $.getJSON('@Url.Action("StockbyCategories_Table_load","Stock")', { 'CategoryID': lvc }, function (datas) {
                Tabsbysearch.empty();
                $(TBsearchs).val("");
                $.each(datas, function (idx, stockbycategory) {
                    var cell1 = $("<td></td>").text(stockbycategory.SI_StockID);
                    var cell2 = $("<td></td>").text(stockbycategory.SI_StockName);
                    var cell3 = $("<td></td>").text('加入').attr({ name: 'btnlistnumberadd', onclick: 'btnlistnumberadd(event)' }).addClass('tablebtn');
                    var row = $("<tr></tr>").append([cell1, cell2, cell3]).appendTo(Tabsbysearch);
                });
            });
        });

        //股票表格_查詢事件
        $(LBsearchs).on('click', function (event) {
            event.preventDefault();
            $.getJSON('@Url.Action("StockbyStockIDorStockName_Table_load","Stock")', { 'Search': $(TBsearchs).val() }, function (datas) {
                Tabsbysearch.empty();
                $.each(datas, function (idx, stockbysearch) {
                    var cell1 = $("<td></td>").text(stockbysearch.SI_StockID);
                    var cell2 = $("<td></td>").text(stockbysearch.SI_StockName);
                    var cell3 = $("<td></td>").text('加入').attr({ name: 'btnlistnumberadd', onclick: 'btnlistnumberadd(event)' }).addClass('tablebtn');
                    var row = $("<tr></tr>").append([cell1, cell2, cell3]).appendTo(Tabsbysearch);
                });
            });
        });

        //大廳(自選)DDL_option改變事件
        $(mainDDL).change(function () {
            var mainlistid = $(mainDDL).val();
            $.getJSON('@Url.Action("MainStockbySSS", "Stock")', { 'ListID': mainlistid}, function (datas) {
                var fragment = $(document.createDocumentFragment());
                $.each(datas, function (idx, s) {

                    var Yprice = s.SIH_Price;
                    var maxprice = (Yprice * 1.1).toFixed(2);
                    var minprice = (Yprice * 0.9).toFixed(2);
                    var highprice = Yprice;
                    var lowprice = Yprice;
                    var Nprice = Yprice;
                    var totalprice = 0;
                    var LiftUnit = 0;
                    var totalvolume = 0;

                    if (Yprice < 10)
                    { LiftUnit = 0.01; }
                    else if (Yprice >= 10 && Yprice < 50)
                    { LiftUnit = 0.05; }
                    else if (Yprice >= 50 && Yprice < 100)
                    { LiftUnit = 0.1; }
                    else if (Yprice >= 100 && Yprice < 500)
                    { LiftUnit = 0.5; }
                    else if (Yprice >= 500 && Yprice < 1000)
                    { LiftUnit = 1; }
                    else if (Yprice >= 1000)
                    { LiftUnit = 5; }




                    for (var i = 0; i < 3240; i++) {


                        var NewLU = Math.floor(Math.random() * (maxprice - minprice + 1))
                        var NewLU2 = parseFloat(NewLU) + parseFloat(minprice)


                        if (NewLU2 > Yprice) {
                            Nprice += LiftUnit;
                            if (Nprice > maxprice) {
                                Nprice -= LiftUnit;
                            }
                        }
                        if (NewLU2 < Yprice) {
                            Nprice -= LiftUnit;
                            if (Nprice < minprice) {
                                Nprice += LiftUnit;
                            }
                        }
                        if (NewLU2 == Yprice)
                        { Nprice = Nprice; }

                        if (Nprice > highprice)
                        { highprice = Nprice; }
                        if (Nprice < lowprice)
                        { lowprice = Nprice; }

                        totalprice += Nprice;
                        totalvolume += Math.floor(Math.random() * 5);


                    }

                    //昨收 s.SI_StockName

                    var cell1 = $('<td></td>').text(s.SSS_ListNumberID);
                    var cell2 = $('<td></td>').text(s.SI_StockID).attr({ name: 'btnchangestocktrend', onclick: 'btnchangestocktrend(event)' }).addClass('Developerbtn');
                    var cell3 = $('<td></td>').text(s.SI_StockName);
                    var cell4 = $('<td></td>'); //買進
                    var cell5 = $('<td></td>'); //賣出
                    var cell6 = $('<td></td>'); //成交
                    var cell7 = $('<td></td>'); //漲跌
                    var cell8 = $('<td></td>'); //漲幅

                    var cell9 = $('<td></td>'); //單量
                    var cell10 = $('<td></td>').text(Math.floor(Math.random() * totalvolume));


                    var r = Math.floor(Math.random() * 2);
                    var r2 = Math.floor(Math.random() * 4) - 2;

                    if (Nprice >= s.SIH_Price) {
                        var p6 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:red").appendTo(cell6);
                        var p7 = $('<p></p>').text("▲" + (Nprice - Yprice).toFixed(2)).attr("style", "margin-bottom:0;color:red").appendTo(cell7);
                        var p8 = $('<p></p>').text("+" + ((Nprice - Yprice).toFixed(2) / Yprice).toFixed(2) + "%").attr("style", "margin-bottom:0;color:red").appendTo(cell8);
                    }
                    else if (Nprice < s.SIH_Price) {
                        var p6 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:green").appendTo(cell6);
                        var p7 = $('<p></p>').text("▼" + (Nprice - Yprice).toFixed(2)).attr("style", "margin-bottom:0;color:green").appendTo(cell7);
                        var p8 = $('<p></p>').text(((Nprice - Yprice).toFixed(2) / Yprice).toFixed(2) + "%").attr("style", "margin-bottom:0;color:green").appendTo(cell8);
                    }



                    if (r == 1) {
                        if (Nprice.toFixed(2) >= s.SIH_Price) {
                            var p4 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:red").appendTo(cell4);
                        }
                        else if (Nprice.toFixed(2) < s.SIH_Price) {
                            var p4 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:green").appendTo(cell4);
                        }

                        var p5text = (Nprice + (LiftUnit * r2)).toFixed(2);
                        if (p5text >= s.SIH_Price) {
                            var p5 = $('<p></p>').text(p5text).attr("style", "margin-bottom:0;color:red").appendTo(cell5);
                        }
                        else if (p5text < s.SIH_Price) {
                            var p5 = $('<p></p>').text(p5text).attr("style", "margin-bottom:0;color:green").appendTo(cell5);
                        }


                        var p9 = $('<p></p>').text(Math.floor(Math.random() * 8) + 1).attr("style", "margin-bottom:0;color:red").appendTo(cell9);


                    }
                    else if (r == 0) {
                        var p4text = (Nprice - (LiftUnit * r2)).toFixed(2)
                        if (p4text >= s.SIH_Price) {
                            var p4 = $('<p></p>').text(p4text).attr("style", "margin-bottom:0;color:red").appendTo(cell4);
                        }
                        else if (p4text < s.SIH_Price) {
                            var p4 = $('<p></p>').text(p4text).attr("style", "margin-bottom:0;color:green").appendTo(cell4);
                        }

                        if (Nprice.toFixed(2) >= s.SIH_Price) {
                            var p5 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:red").appendTo(cell5);
                        }
                        else if (Nprice.toFixed(2) < s.SIH_Price) {
                            var p5 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:green").appendTo(cell5);
                        }


                        var p9 = $('<p></p>').text(Math.floor(Math.random() * 8) + 1).attr("style", "margin-bottom:0;color:green").appendTo(cell9);

                    }


                    var row = $('<tr></tr>').append([cell1, cell2, cell3, cell4, cell5, cell6, cell7, cell8, cell9, cell10]);
                    fragment.append(row);
                })
                $('#maintb').html(fragment);
            })
        });

        //大廳(上市)DDL_option改變事件
        $(maincategoryDDL).change(function () {
            var maincategoryid = $(maincategoryDDL).val();
            $.getJSON('@Url.Action("MainStockbyCategory", "Stock")', { 'CategoryID': maincategoryid}, function (datas) {
                var fragment = $(document.createDocumentFragment());
                $.each(datas, function (idx, s) {

                    var Yprice = s.SIH_Price;
                    var maxprice = (Yprice * 1.1).toFixed(2);
                    var minprice = (Yprice * 0.9).toFixed(2);
                    var highprice = Yprice;
                    var lowprice = Yprice;
                    var Nprice = Yprice;
                    var totalprice = 0;
                    var LiftUnit = 0;
                    var totalvolume = 0;

                    if (Yprice < 10)
                    { LiftUnit = 0.01; }
                    else if (Yprice >= 10 && Yprice < 50)
                    { LiftUnit = 0.05; }
                    else if (Yprice >= 50 && Yprice < 100)
                    { LiftUnit = 0.1; }
                    else if (Yprice >= 100 && Yprice < 500)
                    { LiftUnit = 0.5; }
                    else if (Yprice >= 500 && Yprice < 1000)
                    { LiftUnit = 1; }
                    else if (Yprice >= 1000)
                    { LiftUnit = 5; }




                    for (var i = 0; i < 3240; i++) {


                        var NewLU = Math.floor(Math.random() * (maxprice - minprice + 1))
                        var NewLU2 = parseFloat(NewLU) + parseFloat(minprice)


                        if (NewLU2 > Yprice) {
                            Nprice += LiftUnit;
                            if (Nprice > maxprice) {
                                Nprice -= LiftUnit;
                            }
                        }
                        if (NewLU2 < Yprice) {
                            Nprice -= LiftUnit;
                            if (Nprice < minprice) {
                                Nprice += LiftUnit;
                            }
                        }
                        if (NewLU2 == Yprice)
                        { Nprice = Nprice; }

                        if (Nprice > highprice)
                        { highprice = Nprice; }
                        if (Nprice < lowprice)
                        { lowprice = Nprice; }

                        totalprice += Nprice;
                        totalvolume += Math.floor(Math.random() * 5);


                    }

                    //昨收 s.SI_StockName

                    var cell1 = $('<td></td>').text(s.SI_StockID).attr({ name: 'btnchangestocktrend', onclick: 'btnchangestocktrend(event)' }).addClass('Developerbtn');
                    var cell2 = $('<td></td>').text(s.SI_StockName);
                    var cell3 = $('<td></td>'); //買進
                    var cell4 = $('<td></td>'); //賣出
                    var cell5 = $('<td></td>'); //成交
                    var cell6 = $('<td></td>'); //漲跌
                    var cell7 = $('<td></td>'); //漲幅

                    var cell8 = $('<td></td>'); //單量
                    var cell9 = $('<td></td>').text(Math.floor(Math.random() * totalvolume));


                    var r = Math.floor(Math.random() * 2);
                    var r2 = Math.floor(Math.random() * 4) - 2;

                    if (Nprice >= s.SIH_Price) {
                        var p5 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:red").appendTo(cell5);
                        var p6 = $('<p></p>').text("▲" + (Nprice - Yprice).toFixed(2)).attr("style", "margin-bottom:0;color:red").appendTo(cell6);
                        var p7 = $('<p></p>').text("+" + ((Nprice - Yprice).toFixed(2) / Yprice).toFixed(2) + "%").attr("style", "margin-bottom:0;color:red").appendTo(cell7);
                    }
                    else if (Nprice < s.SIH_Price) {
                        var p5 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:green").appendTo(cell5);
                        var p6 = $('<p></p>').text("▼" + (Nprice - Yprice).toFixed(2)).attr("style", "margin-bottom:0;color:green").appendTo(cell6);
                        var p7 = $('<p></p>').text(((Nprice - Yprice).toFixed(2) / Yprice).toFixed(2) + "%").attr("style", "margin-bottom:0;color:green").appendTo(cell7);
                    }



                    if (r == 1) {
                        if (Nprice.toFixed(2) >= s.SIH_Price) {
                            var p3 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:red").appendTo(cell3);
                        }
                        else if (Nprice.toFixed(2) < s.SIH_Price) {
                            var p3 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:green").appendTo(cell3);
                        }

                        var p4text = (Nprice + (LiftUnit * r2)).toFixed(2);
                        if (p4text >= s.SIH_Price) {
                            var p4 = $('<p></p>').text(p4text).attr("style", "margin-bottom:0;color:red").appendTo(cell4);
                        }
                        else if (p4text < s.SIH_Price) {
                            var p4 = $('<p></p>').text(p4text).attr("style", "margin-bottom:0;color:green").appendTo(cell4);
                        }


                        var p8 = $('<p></p>').text(Math.floor(Math.random() * 8) + 1).attr("style", "margin-bottom:0;color:red").appendTo(cell8);


                    }
                    else if (r == 0) {
                        var p3text = (Nprice - (LiftUnit * r2)).toFixed(2)
                        if (p3text >= s.SIH_Price) {
                            var p3 = $('<p></p>').text(p3text).attr("style", "margin-bottom:0;color:red").appendTo(cell3);
                        }
                        else if (p3text < s.SIH_Price) {
                            var p3 = $('<p></p>').text(p3text).attr("style", "margin-bottom:0;color:green").appendTo(cell3);
                        }


                        if (Nprice.toFixed(2) >= s.SIH_Price) {
                            var p4 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:red").appendTo(cell4);
                        }
                        else if (Nprice.toFixed(2) < s.SIH_Price) {
                            var p4 = $('<p></p>').text(Nprice.toFixed(2)).attr("style", "margin-bottom:0;color:green").appendTo(cell4);
                        }



                        var p8 = $('<p></p>').text(Math.floor(Math.random() * 8) + 1).attr("style", "margin-bottom:0;color:green").appendTo(cell8);


                    }


                    var row = $('<tr></tr>').append([cell1, cell2, cell3, cell4, cell5, cell6, cell7, cell8, cell9]);
                    fragment.append(row);
                })
                $('#maintbbycategory').html(fragment);
            })

        });

        //掛單DDL_option改變事件
        $(ordercheckDDL).change(function () {
            if (ordercheckDDL.val() == 0)
            {
                $.getJSON('@Url.Action("PendingOrderHistory_Table_load", "Stock")', {  'AC': $('#stocktradeaccountid option:selected').val(), 'Check': ordercheckDDL.val() }, function (datas) {
                    pendingordertb.empty();
                    $.each(datas, function (idx, order) {
                        var cell1 = $("<td></td>").text(order.POH_ID);
                        var cell2 = $("<td></td>").text(order.SI_StockName + "(" + order.POH_StockID + ")");
                        var cell3p = $("<p></p>").text(order.POH_BuySold);
                        var cell3 = $("<td></td>").html(cell3p);
                        if (order.POH_BuySold == "買") {
                            $(cell3[0].childNodes[0]).css({ "color": "red", "margin": 0 });
                        }
                        else if (order.POH_BuySold == "賣") {
                            $(cell3[0].childNodes[0]).css({ "color": "green", "margin": 0 });
                        }
                        var cell4 = $("<td></td>").text(order.POH_Price);
                        var cell5 = $("<td></td>").text(order.POH_Volume);
                        var cell6 = $("<td></td>").text(JSON.parseWithDate(JSON.stringifyWcf(order.POH_OrderTime)).f("yyyy-MM-dd HH:mm:ss"));
                        var cell7 = $("<td></td>").text('取消掛單').attr({ name: 'btnpendingordercancel', onclick: 'btnpendingordercancel(event)' }).addClass('tablebtn');
                        var cell8 = $("<td></td>").text('交易完成鈕').attr({ name: 'btnupdatetostocktrade', onclick: 'btnupdatetostocktrade(event)', }).addClass('Developerbtn');

                        var row = $("<tr></tr>").append([cell1, cell2, cell3, cell4, cell5, cell6, cell7, cell8]).appendTo(pendingordertb);
                    });
                });

            }
            else if (ordercheckDDL.val() == 1)
            {
                $.getJSON('@Url.Action("PendingOrderHistory_Table_load", "Stock")', {  'AC': $('#stocktradeaccountid option:selected').val(), 'Check': ordercheckDDL.val() }, function (datas) {
                    pendingordertb.empty();
                    $.each(datas, function (idx, order) {
                        var cell1 = $("<td></td>").text(order.POH_ID);
                        var cell2 = $("<td></td>").text(order.SI_StockName + "(" + order.POH_StockID + ")");
                        var cell3p = $("<p></p>").text(order.POH_BuySold);
                        var cell3 = $("<td></td>").html(cell3p);
                        if (order.POH_BuySold == "買") {
                            $(cell3[0].childNodes[0]).css({ "color": "red", "margin": 0 });
                        }
                        else if (order.POH_BuySold == "賣") {
                            $(cell3[0].childNodes[0]).css({ "color": "green", "margin": 0 });
                        }
                        var cell4 = $("<td></td>").text(order.POH_Price);
                        var cell5 = $("<td></td>").text(order.POH_Volume);
                        var cell6 = $("<td></td>").text(JSON.parseWithDate(JSON.stringifyWcf(order.POH_OrderTime)).f("yyyy-MM-dd HH:mm:ss"));
                        //var cell7 = $("<td></td>").text('重新掛單').attr({ name: 'btnpendingorderrepending', onclick: 'btnpendingorderrepending(event)' }).addClass('tablebtn');

                        var row = $("<tr></tr>").append([cell1, cell2, cell3, cell4, cell5, cell6]).appendTo(pendingordertb);
                    });
                });

            }

        });

        //掛單表格_取消事件
        function btnpendingordercancel(event) {
            var pendingorderid = event.path[1].childNodes[0].textContent;
            $.getJSON('@Url.Action("PendingOrderHistory_Table_Cancel", "Stock")', { 'AC': $('#stocktradeaccountid option:selected').val(), 'Check': ordercheckDDL.val(), 'OID': pendingorderid}, function (datas) {
                    pendingordertb.empty();
                    $.each(datas, function (idx, order) {
                        var cell1 = $("<td></td>").text(order.POH_ID);
                        var cell2 = $("<td></td>").text(order.SI_StockName + "(" + order.POH_StockID + ")");
                        var cell3p = $("<p></p>").text(order.POH_BuySold);
                        var cell3 = $("<td></td>").html(cell3p);
                        if (order.POH_BuySold == "買") {
                            $(cell3[0].childNodes[0]).css({ "color": "red", "margin": 0 });
                        }
                        else if (order.POH_BuySold == "賣") {
                            $(cell3[0].childNodes[0]).css({ "color": "green", "margin": 0 });
                        }
                        var cell4 = $("<td></td>").text(order.POH_Price);
                        var cell5 = $("<td></td>").text(order.POH_Volume);
                        var cell6 = $("<td></td>").text(JSON.parseWithDate(JSON.stringifyWcf(order.POH_OrderTime)).f("yyyy-MM-dd HH:mm:ss"));
                        var cell7 = $("<td></td>").text('取消掛單').attr({ name: 'btnpendingordercancel', onclick: 'btnpendingordercancel(event)' }).addClass('tablebtn');
                        var cell8 = $("<td></td>").text('交易完成鈕').attr({ name: 'btnupdatetostocktrade', onclick: 'btnupdatetostocktrade(event)', }).addClass('Developerbtn');

                        var row = $("<tr></tr>").append([cell1, cell2, cell3, cell4, cell5, cell6, cell7, cell8]).appendTo(pendingordertb);
                    });
                    alert("已取消掛單<br/>\r\n編號:" + event.path[1].childNodes[0].textContent + "<br/>\r\n股票:" + event.path[1].childNodes[1].textContent + "<br/>\r\n買/賣:" + event.path[1].childNodes[2].textContent +"<br/>\r\n價:" + event.path[1].childNodes[3].textContent + " 量:" + event.path[1].childNodes[4].textContent);
                });

        }

        //掛單表格_交易事件(掛單紀錄表update/交易紀錄表add+入庫add,出庫update)
        function btnupdatetostocktrade(event) {
            var pendingorderid = event.path[1].childNodes[0].textContent;
            var pendingorderbs = event.path[1].childNodes[2].textContent;

            $.getJSON('@Url.Action("PendingOrderHistory_Table_Update", "Stock")', {  'AC': $('#stocktradeaccountid option:selected').val(), 'Check': ordercheckDDL.val(), 'OID': pendingorderid, 'BS': pendingorderbs}, function (datas) {
                pendingordertb.empty();
                $.each(datas, function (idx, order) {
                    var cell1 = $("<td></td>").text(order.POH_ID);
                    var cell2 = $("<td></td>").text(order.SI_StockName + "(" + order.POH_StockID + ")");
                    var cell3p = $("<p></p>").text(order.POH_BuySold);
                    var cell3 = $("<td></td>").html(cell3p);
                    if (order.POH_BuySold == "買") {
                        $(cell3[0].childNodes[0]).css({ "color": "red", "margin": 0 });
                    }
                    else if (order.POH_BuySold == "賣") {
                        $(cell3[0].childNodes[0]).css({ "color": "green", "margin": 0 });
                    }
                    var cell4 = $("<td></td>").text(order.POH_Price);
                    var cell5 = $("<td></td>").text(order.POH_Volume);
                    var cell6 = $("<td></td>").text(JSON.parseWithDate(JSON.stringifyWcf(order.POH_OrderTime)).f("yyyy-MM-dd HH:mm:ss"));
                    var cell7 = $("<td></td>").text('取消掛單').attr({ name: 'btnpendingordercancel', onclick: 'btnpendingordercancel(event)' }).addClass('tablebtn');
                    var cell8 = $("<td></td>").text('交易完成鈕').attr({ name: 'btnupdatetostocktrade', onclick: 'btnupdatetostocktrade(event)', }).addClass('Developerbtn');


                    var row = $("<tr></tr>").append([cell1, cell2, cell3, cell4, cell5, cell6, cell7, cell8]).appendTo(pendingordertb);
                });
                alert("交易成功<br/>\r\n編號:" + event.path[1].childNodes[0].textContent + "<br/>\r\n股票:" + event.path[1].childNodes[1].textContent + "<br/>\r\n買/賣:" + event.path[1].childNodes[2].textContent + "<br/>\r\n價:" + event.path[1].childNodes[3].textContent + " 量:" + event.path[1].childNodes[4].textContent);
            })
            .done(function () {
                STRReload();
                StockTreasuryReload();
            });
        }

        //更換走勢圖
        function btnchangestocktrend(event) {
            $.getJSON('@Url.Action("trendchart_select", "Stock")', { 'Stock': event.path[0].childNodes[0].data }, function (datas) {


            var stock = datas.SI_StockName + "(" + datas.SIH_StockID + ")";
            var Yprice = datas.SIH_Price;
            var maxprice = (Yprice * 1.1).toFixed(2);
            var minprice = (Yprice * 0.9).toFixed(2);
            var LiftUnit = 0.00;
            var Nprice = Yprice;
            var highprice = Yprice;
            var lowprice = Yprice;
            var v = Math.floor(Math.random() * (5000));
            var totalprice = 0;

            if (Yprice < 10)
            { LiftUnit = 0.01; }
            else if (Yprice >= 10 && Yprice < 50)
            { LiftUnit = 0.05; }
            else if (Yprice >= 50 && Yprice < 100)
            { LiftUnit = 0.1; }
            else if (Yprice >= 100 && Yprice < 500)
            { LiftUnit = 0.5; }
            else if (Yprice >= 500 && Yprice < 1000)
            { LiftUnit = 1; }
            else if (Yprice >= 1000)
            { LiftUnit = 5; }





        Highcharts.setOptions({
            global: {
                useUTC: false
            }
        });

        Highcharts.chart('trendchart', {
            chart: {
                type: 'line',
                animation: Highcharts.svg, // don't animate in old IE
                marginRight: 10,
                //events: {
                //    load: function () {

                //        // 每秒新增
                //        var series = this.series[0];
                //        setInterval(function () {
                //            var x = (new Date()).getTime(), // current time
                //                y = Math.random();
                //            series.addPoint([x, y], true, true);
                //        }, 1000);
                //    }
                //}
            },
            plotOptions: {
                line: {
                    marker: {
                        enabled: false
                    }
                },
                series: {
                    turboThreshold: 10000 // 或者更多，另外可以直接去数据的长度
                }
            },
            title: {
                text: stock
            },
            xAxis: {
                type: 'datetime',
                tickPixelInterval: 150
            },
            yAxis: {
                title: {
                    text: ''
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }],
                max: maxprice,
                min: minprice
            },
            tooltip: {
                formatter: function () {
                    return '<b>' + this.series.name + '</b><br/>' +
                        Highcharts.dateFormat(' %H:%M:%S', this.x) + '<br/>' +   //%Y-%m-%d
                        Highcharts.numberFormat(this.y, 2);
                }
            },
            legend: {
                enabled: false
            },
            exporting: {
                enabled: false
            },
            credits: {
                enabled: false
            },

            series: [{
                name: stock,
                color: '#FF3333',
                lineWidth: 1,
                data: (function () {
                    // generate an array of random data
                    var data = [],
                        time = (new Date()).setHours(9, 0, 0), //(new Date()).getTime().
                        i;

                    for (i = 0; i <= 3240; i += 1) {  //12*60*5=3600

                        var NewLU = Math.floor(Math.random() * (maxprice - minprice + 1))
                        var NewLU2 = parseFloat(NewLU) + parseFloat(minprice)


                        if (NewLU2 > Yprice) {
                            Nprice += LiftUnit;
                            if (Nprice > maxprice) {
                                Nprice -= LiftUnit;
                            }
                        }
                        if (NewLU2 < Yprice) {
                            Nprice -= LiftUnit;
                            if (Nprice < minprice) {
                                Nprice += LiftUnit;
                            }
                        }
                        if (NewLU2 == Yprice)
                        { Nprice = Nprice; }


                        if (Nprice > highprice)
                        { highprice = Nprice; }
                        if (Nprice < lowprice)
                        { lowprice = Nprice; }

                        totalprice += Nprice;




                        data.push({
                            x: time + i * 5 * 1000, // i * 秒數
                            y: Nprice
                        });


                    }
                    return data;
                }())
            }]
        });

                trendchartinfo.empty();


                var cell1 = $('<td></td>').text("成交").attr({ "style": "border:1px solid black;" });
                var cell2 = $('<td></td>').attr({ "style": "border:1px solid black;", "align": "right" });
                if (Nprice.toFixed(2) > Yprice)
                {
                    var p2 = $('<p></p>').text(Nprice.toFixed(2)).appendTo(cell2).attr( "style","margin-bottom:0;color:red");
                }
                if (Nprice.toFixed(2) <= Yprice)
                {
                    var p2 = $('<p></p>').text(Nprice.toFixed(2)).appendTo(cell2).attr("style", "margin-bottom:0;color:green");
                }

                var cell3 = $('<td></td>').text("時間").attr({ "style": "border:1px solid black;" });
                var cell4 = $('<td></td>').text("13:30:00").attr({ "style": "border:1px solid black;", "align": "right" });
                var row1 = $("<tr></tr>").append([cell1, cell2, cell3, cell4]).appendTo(trendchartinfo);

                var cell5 = $('<td></td>').text("漲跌").attr({ "style": "border:1px solid black;" });
                var cell6 = $('<td></td>').attr({ "style": "border:1px solid black;", "align": "right" });
                if((Nprice - Yprice).toFixed(2) > 0)
                {
                    var p6 = $('<p></p>').text((Nprice - Yprice).toFixed(2)).appendTo(cell6).attr("style", "margin-bottom:0;color:red");
                }
                if((Nprice - Yprice).toFixed(2) <= 0)
                {
                    var p6 = $('<p></p>').text((Nprice - Yprice).toFixed(2)).appendTo(cell6).attr("style", "margin-bottom:0;color:green");
                }
                var cell7 = $('<td></td>').text("單量").attr({ "style": "border:1px solid black;" });
                var cell8 = $('<td></td>').text(Math.floor(Math.random() * (30))).attr({ "style": "border:1px solid black;", "align": "right" });
                var row2 = $("<tr></tr>").append([cell5, cell6, cell7, cell8]).appendTo(trendchartinfo);

                var cell9 = $('<td></td>').text("漲跌幅").attr({ "style": "border:1px solid black;" });
                var cell10 = $('<td></td>').attr({ "style": "border:1px solid black;", "align": "right" });
                if ((Math.round(((Nprice - Yprice) / Yprice) * 100) / 100) > 0)
                {
                    var p10 = $('<p></p>').text(Math.round(((Nprice - Yprice) / Yprice) * 100) / 100 + "%").appendTo(cell10).attr("style", "margin-bottom:0;color:red");
                }
                if ((Math.round(((Nprice - Yprice) / Yprice) * 100) / 100) <= 0)
                {
                    var p10 = $('<p></p>').text(Math.round(((Nprice - Yprice) / Yprice) * 100) / 100 + "%").appendTo(cell10).attr("style", "margin-bottom:0;color:green");
                }
                var cell11 = $('<td></td>').text("總量").attr({ "style": "border:1px solid black;" });
                var cell12 = $('<td></td>').text(v).attr({ "style": "border:1px solid black;", "align": "right" });
                var row3 = $("<tr></tr>").append([cell9, cell10, cell11, cell12]).appendTo(trendchartinfo);

                var cell13 = $('<td></td>').text("最高").attr({ "style": "border:1px solid black;" });
                var cell14 = $('<td></td>').attr({ "style": "border:1px solid black;", "align": "right" });
                if (highprice.toFixed(2) > Yprice)
                {
                    var p14 = $('<p></p>').text(highprice.toFixed(2)).appendTo(cell14).attr("style", "margin-bottom:0;color:red");
                }
                if (highprice.toFixed(2) <= Yprice)
                {
                    var p14 = $('<p></p>').text(highprice.toFixed(2)).appendTo(cell14).attr("style", "margin-bottom:0;color:green");
                }
                var cell15 = $('<td></td>').text("昨量").attr({ "style": "border:1px solid black;" });
                var cell16 = $('<td></td>').text(Math.floor(Math.random() * (5000))).attr({ "style": "border:1px solid black;", "align": "right" });
                var row4 = $("<tr></tr>").append([cell13, cell14, cell15, cell16]).appendTo(trendchartinfo);

                var cell17 = $('<td></td>').text("最低").attr({ "style": "border:1px solid black;" });
                var cell18 = $('<td></td>').attr({ "style": "border:1px solid black;", "align": "right" });
                if (lowprice.toFixed(2) > Yprice)
                {
                    var p18 = $('<p></p>').text(lowprice.toFixed(2)).appendTo(cell18).attr("style", "margin-bottom:0;color:red");
                }
                if (lowprice.toFixed(2) <= Yprice)
                {
                    var p18 = $('<p></p>').text(lowprice.toFixed(2)).appendTo(cell18).attr("style", "margin-bottom:0;color:green");
                }
                var cell19 = $('<td></td>').text("昨收").attr({ "style": "border:1px solid black;" });
                var cell20 = $('<td></td>').text(Yprice).attr({ "style": "border:1px solid black;", "align": "right" });
                var row5 = $("<tr></tr>").append([cell17, cell18, cell19, cell20]).appendTo(trendchartinfo);

                var cell21 = $('<td></td>').text("均價").attr({ "style": "border:1px solid black;" });
                var cell22 = $('<td></td>').attr({ "style": "border:1px solid black;", "align": "right" });
                if ((totalprice / 3240).toFixed(2) > Yprice) {
                    var p22 = $('<p></p>').text((totalprice / 3240).toFixed(2)).appendTo(cell22).attr("style", "margin-bottom:0;color:red");
                }
                if ((totalprice / 3240).toFixed(2) <= Yprice) {
                    var p22 = $('<p></p>').text((totalprice / 3240).toFixed(2)).appendTo(cell22).attr("style", "margin-bottom:0;color:green");
                }
                var cell23 = $('<td></td>').text("開盤").attr({ "style": "border:1px solid black;" });
                var cell24 = $('<td></td>').text(Yprice).attr({ "style": "border:1px solid black;", "align": "right" });
                var row6 = $("<tr></tr>").append([cell21, cell22, cell23, cell24]).appendTo(trendchartinfo);

                var cell25 = $('<td></td>').text("振幅").attr({ "style": "border:1px solid black;" });
                var cell26 = $('<td></td>').text(Math.round(((highprice - lowprice) / Yprice) * 100) / 100).attr({ "style": "border:1px solid black;", "align": "right" });
                var cell27 = $('<td></td>').text("成交值").attr({ "style": "border:1px solid black;" });
                var cell28 = $('<td></td>').text((2 * (Math.random() * 3).toFixed(2))  + "億").attr({ "style": "border:1px solid black;", "align": "right" });
                var row7 = $("<tr></tr>").append([cell25, cell26, cell27, cell28]).appendTo(trendchartinfo);

            });

            Highcharts.chart('trendchart2', {
                chart: {
                    type: 'column'
                },
                title: {
                    text: '',
                },
                xAxis: {
                    type: 'datetime',
                    tickPixelInterval: 150,
                    labels:
                    {
                        enabled: false
                    }
                },
                yAxis: {
                    title: {
                        text: ''
                    },
                    labels: {
                        style: {
                            color: '#FF3333',
                            fontSize: '8px'
                        }
                    },
                    max: 1600,

                },
                legend: {
                    enabled: false
                },
                tooltip: {
                    //pointFormat: '量: <b>{point.y:.1f} 張</b>'
                    formatter: function () {
                        return '<b>' + this.series.name + '</b><br/>' +
                            Highcharts.dateFormat(' %H:%M:%S', this.x) + '<br/>' +   //%Y-%m-%d
                            '量:' + Highcharts.numberFormat(this.y, 0) + '張';
                    }
                },
                exporting: {
                    enabled: false
                },
                credits: {
                    enabled: false
                },
                plotOptions: {
                    line: {
                        marker: {
                            enabled: false
                        }
                    },
                    series: {
                        turboThreshold: 10000, // 或者更多，另外可以直接去数据的长度
                        pointWidth: 0.1
                    },

                },
                series: [{
                    name: '交易量',
                    color: '#FF3333',
                    lineWidth: 0.1,
                    data: (function () {
                        // generate an array of random data
                        var data = [],
                            time = (new Date()).setHours(9, 0, 0), //(new Date().getTime().
                            i;

                        for (i = 0; i <= 3240; i += 1) {  //12*60*5=3600  3240

                            var v = Math.floor(Math.random() * 15);

                            if (Math.round(i % 11) == 0) {
                                v = parseFloat(Math.floor(Math.random() * 300)) + parseFloat(25);
                            }
                            if (i == 0) {
                                v = parseFloat(Math.floor(Math.random() * 1100)) + parseFloat(500);
                            }

                            data.push({
                                x: time + i * 5 * 1000, // i * 秒數
                                y: v
                            });


                        }
                        return data;
                    }()),
                }]
            });


        }


        //交易紀錄表日期DDL_option改變事件
        $(strDDL).change(function () {
            STRReload();
        });

        //快速選股_dbclick事件
        $(accordioncategory).on("dblclick", "a", function (event) {
            var v = $(event.target.parentNode).val();
            STPReload();
            $(stockidfastid).val(v).focus();


            off3();
        })
        //快速選股_focusout事件(導入股票名稱)
        $(stockidfastid).focusout(function () {
            $.getJSON('@Url.Action("FastStockID_Input_load", "Stock")', { 'StockID': $(stockidfastid).val() }, function (datas) {
                STPReload();
                $('#stockidfastname').val(datas);
            })
        });


        //整股/定價/零股
        function PV(event) {
            $('.PVmode').attr("class", "PVmode radiusbtn2");
            $('.PVmode click').prevObject[0].activeElement.className += ' PVmodeclicknow';
        }
        //定價_click事件
        $('#order_fixprice').click(function () {
            OPclean();
            order_pricenow.attr("style", "background-color:#f9ff9e;width:40px");
            order_priceuplimit.attr("disabled", '');
            order_pricedownlimit.attr("disabled", '');
            STPReload();
            thousandshare.text("張數");
            order_price.attr("style", "width:140px;text-align: right;margin-left:16px");
        });
        //整股_click事件
        $('#order_whole').click(function () {
            order_priceuplimit.removeAttr("disabled");
            order_pricedownlimit.removeAttr("disabled");
            thousandshare.text("張數");

        })
        //零股_click事件
        $('#order_zero').click(function () {
            order_priceuplimit.removeAttr("disabled");
            order_pricedownlimit.removeAttr("disabled");
            thousandshare.text("股數");
        })


        //買進/賣出
        order_buystock.click(function () {
            $('#maintab-4-1').attr("style", "background-color:#ffc2bf");
            order_buystock.attr("style", "background-color:#ec6a9a;color:white").addClass("orderstate");
            order_soldstock.attr("style", "").removeClass("orderstate");
        });
        order_soldstock.click(function () {
            $('#maintab-4-1').attr("style", "background-color:#c2ffc0");
            order_soldstock.attr("style", "background-color:#1eb145;color:white").addClass("orderstate");
            order_buystock.attr("style", "").removeClass("orderstate");
        });

        $('#placeanorder').click(function () {
            var AC = $('#stocktradeaccountid option:selected').val();
            if (order_buystock.hasClass("orderstate") && order_volume.val() >= 1)
            {             
                $.getJSON('@Url.Action("Place_An_Orders", "Stock")', { 'AC': AC, 'StockID': $(stockidfastid).val(), 'Price': order_price.val(), 'Volume': $('#order_volume').val() }, function (datas) {
                    alert("『買股』<br />" + datas);
                }).done(function () {
                    POHReload(AC);
                });
            }
            if (order_soldstock.hasClass("orderstate") && order_volume.val() >= 1)
            {
                $.getJSON('@Url.Action("CheckTreasuryStockCanSell", "Stock")', { 'AC': AC, 'StockID': $(stockidfastid).val(), 'Price': order_price.val(), 'Volume': $('#order_volume').val() }, function (datas) {
                    alert("『賣股』<br />"+datas);
                }).done(function () {
                    POHReload(AC);
                });
            }
            if ((order_buystock.hasClass("orderstate") == false) && (order_soldstock.hasClass("orderstate") == false))
            {
                alert("請選擇買/賣股");
            }

        });



        //現漲跌
        order_pricenow.click(function () {
            OPclean();
            order_pricenow.attr("style", "background-color:#f9ff9e;width:40px");
            STPReload();
            order_price.removeAttr("disabled").removeAttr("style").attr("style", "width:140px;text-align: right;margin-left:16px");
        });
        order_priceuplimit.click(function () {
            OPclean();
            order_priceuplimit.attr("style", "background-color:#cf2323;width:40px");
            order_price.val(order_price.attr('max'));
            order_price.attr({ "disabled": '', "style":"color:grey;width:140px;text-align: right;margin-left:16px"});
        });
        order_pricedownlimit.click(function () {
            OPclean();
            order_pricedownlimit.attr("style", "background-color:#53a846;width:40px");
            order_price.val(order_price.attr('min'));
            order_price.attr({ "disabled": '', "style": "color:grey;width:140px;text-align: right;margin-left:16px" });
        });
        function OPclean() {
            order_pricenow.attr("style", "width:40px");
            order_priceuplimit.attr("style", "width:40px");
            order_pricedownlimit.attr("style", "width:40px");
        }


        //預估成本
        order_volume.change(function () {
            costcalculate();
        });

        order_price.change(function () {
            costcalculate();
        })

        function costcalculate() {
            var cost = order_volume.val() * order_price.val();
            if ($('#order_zero').hasClass("PVmodeclicknow")) {
                $('#EstimatedCost').text("NT$" + cost.toFixed(2));
            }
            else {
                $('#EstimatedCost').text("NT$" +(cost * 1000).toFixed(2));
            }
        }






        //開啟/關閉overlay------
        $('#LBssssetting').click(function (event) {
            event.preventDefault();
            on();
            var n = Tabssslist[0].rows.length + 1
            LabelAddListofNumber.text("編號:" + n);
        });

        $('#LBbackstocktrade').click(function (event) {
            event.preventDefault();
            off();
        });

        $('#LBssss').click(function (event) {
            event.preventDefault();
            on2();
        });

        $('#LBssssfinish').click(function (event) {
            event.preventDefault();
            off2();
        });
        $('#stockidfast').click(function (event) {
            event.preventDefault();
            on3();
        });
        $('#accordionback').click(function (event) {
            event.preventDefault();
            off3();
        });

        function on() {
            $('#overlay').css('display', 'block');
        }
        function off() {
            $('#overlay').css('display', 'none');
            SSSMaintbReload();
        }
        function on2() {
            $('#overlay2').css('display', 'block');
        }
        function off2() {
            $('#overlay2').css('display', 'none');
        }
        function on3() {
            $('#overlay3').css('display', 'block');
        }
        function off3() {
            $('#overlay3').css('display', 'none');
        }

    </script>


<script src="~/Scripts/echarts.min .js"></script>
    <script type="text/javascript">
        // 基于准备好的dom，初始化echarts实例
        var myklineChart = echarts.init(document.getElementById('kline'));
        // 指定图表的配置项和数据  app.title = '2015 年上证指数'


        var rawData = [
            ['2017/12/31', '3570.47', '3539.18', '-33.69', '-0.94%', '3538.35', '3580.6', '176963664', '25403106', '-'],
            ['2017/12/30', '3566.73', '3572.88', '9.14', '0.26%', '3538.11', '3573.68', '187889600', '26778766', '-'],
            ['2017/12/29', '3528.4', '3563.74', '29.96', '0.85%', '3515.52', '3564.17', '182551920', '25093890', '-'],
            ['2017/12/28', '3635.77', '3533.78', '-94.13', '-2.59%', '3533.78', '3641.59', '269983264', '36904280', '-'],
            ['2017/12/25', '3614.05', '3627.91', '15.43', '0.43%', '3601.74', '3635.26', '198451120', '27466004', '-'],
            ['2017/12/24', '3631.31', '3612.49', '-23.6', '-0.65%', '3572.28', '3640.22', '227785216', '31542126', '-'],
            ['2017/12/23', '3653.28', '3636.09', '-15.68', '-0.43%', '3633.03', '3684.57', '298201792', '41990292', '-'],
            ['2017/12/22', '3645.99', '3651.77', '9.3', '0.26%', '3616.87', '3652.63', '261178752', '36084604', '-'],
            ['2017/12/21', '3568.58', '3642.47', '63.51', '1.77%', '3565.75', '3651.06', '299849280', '39831696', '-'],
            ['2017/12/18', '3574.94', '3578.96', '-1.03', '-0.03%', '3568.16', '3614.7', '273707904', '36538580', '-'],
            ['2017/12/17', '3533.63', '3580', '63.81', '1.81%', '3533.63', '3583.41', '283856480', '38143960', '-'],
            ['2017/12/16', '3522.09', '3516.19', '5.83', '0.17%', '3506.29', '3538.69', '193482304', '26528864', '-'],
            ['2017/12/15', '3518.13', '3510.35', '-10.31', '-0.29%', '3496.85', '3529.96', '200471344', '27627494', '-'],
            ['2017/12/14', '3403.51', '3520.67', '86.09', '2.51%', '3399.28', '3521.78', '215374624', '27921354', '-'],
            ['2017/12/11', '3441.6', '3434.58', '-20.91', '-0.61%', '3410.92', '3455.55', '182908880', '24507642', '-'],
            ['2017/12/10', '3469.81', '3455.5', '-16.94', '-0.49%', '3446.27', '3503.65', '200427520', '27949970', '-'],
            ['2017/12/9', '3462.58', '3472.44', '2.37', '0.07%', '3454.88', '3495.7', '195698848', '26785488', '-'],
            ['2017/12/8', '3518.65', '3470.07', '-66.86', '-1.89%', '3466.79', '3518.65', '224367312', '29782174', '-'],
            ['2017/12/7', '3529.81', '3536.93', '11.94', '0.34%', '3506.62', '3543.95', '208302576', '28056158', '-'],
            ['2017/12/4', '3558.15', '3524.99', '-59.83', '-1.67%', '3510.41', '3568.97', '251736416', '31976682', '-'],
            ['2017/12/3', '3525.73', '3584.82', '47.92', '1.35%', '3517.23', '3591.73', '281111232', '33885908', '-'],
            ['2017/12/2', '3450.28', '3536.91', '80.6', '2.33%', '3427.66', '3538.85', '301491488', '36918304', '-'],
            ['2017/12/1', '3442.44', '3456.31', '10.9', '0.32%', '3417.54', '3483.41', '252390752', '33025674', '-'],
            ['2017/11/30', '3433.85', '3445.4', '9.1', '0.26%', '3327.81', '3470.37', '304197888', '38750364', '-'],
            ['2017/11/27', '3616.54', '3436.3', '-199.25', '-5.48%', '3412.43', '3621.9', '354287520', '46431124', '-'],
            ['2017/11/26', '3659.57', '3635.55', '-12.38', '-0.34%', '3629.86', '3668.38', '306761600', '42624744', '-'],
            ['2017/11/25', '3614.07', '3647.93', '31.82', '0.88%', '3607.52', '3648.37', '273024864', '38080292', '-'],
            ['2017/11/24', '3602.89', '3616.11', '5.79', '0.16%', '3563.1', '3616.48', '248810512', '32775852', '-'],
            ['2017/11/23', '3630.87', '3610.31', '-20.18', '-0.56%', '3598.87', '3654.75', '315997472', '41414824', '-'],
            ['2017/11/20', '3620.79', '3630.5', '13.44', '0.37%', '3607.92', '3640.53', '310801984', '41391088', '-'],
            ['2017/11/19', '3573.78', '3617.06', '48.59', '1.36%', '3561.04', '3618.21', '247915584', '32844260', '-'],
            ['2017/11/18', '3605.06', '3568.47', '-36.33', '-1.01%', '3558.7', '3617.07', '297580736', '39233876', '-'],
            ['2017/11/17', '3629.98', '3604.8', '-2.16', '-0.06%', '3598.07', '3678.27', '383575456', '52152036', '-'],
            ['2017/11/16', '3522.46', '3606.96', '26.12', '0.73%', '3519.42', '3607.61', '276187040', '36942184', '-'],
            ['2017/11/13', '3600.76', '3580.84', '-52.06', '-1.43%', '3564.81', '3632.56', '345870944', '46866864', '-'],
            ['2017/11/12', '3656.82', '3632.9', '-17.35', '-0.48%', '3603.23', '3659.31', '361717600', '48283260', '-'],
            ['2017/11/11', '3635', '3650.25', '9.76', '0.27%', '3605.62', '3654.88', '360972672', '46782220', '-'],
            ['2017/11/10', '3617.4', '3640.49', '-6.4', '-0.18%', '3607.89', '3669.53', '429746592', '56005512', '-'],
            ['2017/11/9', '3588.5', '3646.88', '56.85', '1.58%', '3588.5', '3673.76', '503016704', '63618404', '-'],
            ['2017/11/6', '3514.44', '3590.03', '67.21', '1.91%', '3508.83', '3596.38', '429167040', '54328220', '-'],
            ['2017/11/5', '3459.22', '3522.82', '63.18', '1.83%', '3455.53', '3585.66', '553254976', '67867464', '-'],
            ['2017/11/4', '3325.62', '3459.64', '142.94', '4.31%', '3325.62', '3459.65', '339078752', '42610440', '-'],
            ['2017/11/3', '3330.32', '3316.7', '-8.39', '-0.25%', '3302.18', '3346.27', '192897440', '24436056', '-'],
            ['2017/11/2', '3337.58', '3325.08', '-57.48', '-1.70%', '3322.31', '3391.06', '230951136', '28601932', '-'],
            ['2017/10/30', '3380.28', '3382.56', '-4.75', '-0.14%', '3346.59', '3417.2', '243595120', '30726678', '-'],
            ['2017/10/29', '3387.77', '3387.32', '12.12', '0.36%', '3362.51', '3411.71', '235676016', '29450842', '-'],
            ['2017/10/28', '3417.01', '3375.2', '-59.14', '-1.72%', '3367.23', '3439.76', '293523296', '36165620', '-'],
            ['2017/10/27', '3409.14', '3434.34', '4.76', '0.14%', '3332.62', '3441.57', '328172768', '40888724', '-'],
            ['2017/10/26', '3448.65', '3429.58', '17.15', '0.50%', '3402', '3457.52', '365560864', '45394252', '-'],
            ['2017/10/23', '3377.55', '3412.43', '43.7', '1.30%', '3360.22', '3422.02', '347372864', '42526308', '-'],
            ['2017/10/22', '3292.29', '3368.74', '48.06', '1.45%', '3282.99', '3373.78', '323739328', '37545200', '-'],
            ['2017/10/21', '3428.56', '3320.68', '-104.65', '-3.06%', '3265.44', '3447.26', '458455424', '51850924', '-'],
            ['2017/10/20', '3377.55', '3425.33', '38.63', '1.14%', '3357.86', '3425.52', '318973760', '38358252', '-'],
            ['2017/10/19', '3401.63', '3386.7', '-4.65', '-0.14%', '3355.57', '3423.4', '378112160', '45330364', '-'],
            ['2017/10/16', '3358.3', '3391.35', '53.28', '1.60%', '3334.85', '3393.02', '395460576', '45944784', '-'],
            ['2017/10/15', '3255.03', '3338.07', '75.63', '2.32%', '3254.39', '3338.3', '316283840', '36256556', '-'],
            ['2017/10/14', '3280.02', '3262.44', '-30.79', '-0.93%', '3256.25', '3307.32', '295077760', '33027752', '-'],
            ['2017/10/13', '3262.16', '3293.23', '5.57', '0.17%', '3253.25', '3298.63', '297153120', '33480608', '-'],
            ['2017/10/12', '3193.54', '3287.66', '104.51', '3.28%', '3188.41', '3318.71', '386294688', '43554100', '-'],
            ['2017/10/9', '3146.64', '3183.15', '39.79', '1.27%', '3137.79', '3192.72', '234851456', '25637910', '-'],
            ['2017/10/8', '3156.07', '3143.36', '90.58', '2.97%', '3133.13', '3172.28', '234276048', '25883034', '-'],
            ['2017/9/30', '3052.84', '3052.78', '14.64', '0.48%', '3039.74', '3073.3', '146642448', '15656919', '-'],
            ['2017/9/29', '3055.22', '3038.14', '-62.62', '-2.02%', '3021.16', '3068.3', '163222672', '16968660', '-'],
            ['2017/9/28', '3085.57', '3100.76', '8.41', '0.27%', '3042.31', '3103.07', '156727536', '16642240', '-'],
            ['2017/9/25', '3130.85', '3092.35', '-50.34', '-1.60%', '3063', '3149.95', '236263872', '24897112', '-'],
            //['', '', '', '', '', '', '', '', '', '']
        ].reverse();

        function calculateMA(dayCount, data) {
            var result = [];
            for (var i = 0, len = data.length; i < len; i++) {
                if (i < dayCount) {
                    result.push('-');
                    continue;
                }
                var sum = 0;
                for (var j = 0; j < dayCount; j++) {
                    sum += data[i - j][1];
                }
                result.push(sum / dayCount);
            }
            return result;
        }


        var dates = rawData.map(function (item) {
            return item[0];
        });

        var data = rawData.map(function (item) {
            return [+item[1], +item[2], +item[5], +item[6]];
        });
        var option = {
            backgroundColor: '#F0F0F0',
            legend: {
                data: ['日K', 'MA5', 'MA10', 'MA20', 'MA30'],
                inactiveColor: '#777',
                textStyle: {
                    color: '#000000'
                }
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    animation: false,
                    type: 'cross',
                    lineStyle: {
                        color: '#376df4',
                        width: 2,
                        opacity: 1
                    }
                }
            },
            xAxis: {
                type: 'category',
                data: dates,
                axisLine: { lineStyle: { color: '##272727' } }
            },
            yAxis: {
                scale: true,
                axisLine: { lineStyle: { color: '##272727' } },
                splitLine: { show: false }
            },
            grid: {
                bottom: 80
            },
            dataZoom: [{
                textStyle: {
                    color: '#8392A5'
                },
                handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
                handleSize: '80%',
                dataBackground: {
                    areaStyle: {
                        color: '#8392A5'
                    },
                    lineStyle: {
                        opacity: 0.8,
                        color: '#8392A5'
                    }
                },
                handleStyle: {
                    color: '#fff',
                    shadowBlur: 3,
                    shadowColor: 'rgba(0, 0, 0, 0.6)',
                    shadowOffsetX: 2,
                    shadowOffsetY: 2
                }
            }, {
                type: 'inside'
            }],
            animation: false,
            series: [
                {
                    type: 'candlestick',
                    name: '日K',
                    data: data,
                    itemStyle: {
                        normal: {
                            color: '#FD1050',
                            color0: '#0CF49B',
                            borderColor: '#FD1050',
                            borderColor0: '#0CF49B'
                        }
                    }
                },
                {
                    name: 'MA5',
                    type: 'line',
                    data: calculateMA(5, data),
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        normal: {
                            width: 1
                        }
                    }
                },
                {
                    name: 'MA10',
                    type: 'line',
                    data: calculateMA(10, data),
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        normal: {
                            width: 1
                        }
                    }
                },
                {
                    name: 'MA20',
                    type: 'line',
                    data: calculateMA(20, data),
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        normal: {
                            width: 1
                        }
                    }
                },
                {
                    name: 'MA30',
                    type: 'line',
                    data: calculateMA(30, data),
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        normal: {
                            width: 1
                        }
                    }
                }
            ]
        };        

        // 使用刚指定的配置项和数据显示图表。

        myklineChart.setOption(option);
    </script>


<script>
       $.getJSON('@Url.Action("trendchart_select", "Stock")', { 'Stock': 1101 }, function (datas) {


            var stock = datas.SI_StockName + "(" + datas.SIH_StockID + ")";
            var Yprice = datas.SIH_Price;
            var maxprice = (Yprice * 1.1).toFixed(2);
            var minprice = (Yprice * 0.9).toFixed(2);
            var LiftUnit = 0.00;
            var Nprice = Yprice;

            if (Yprice < 10)
            { LiftUnit = 0.01; }
            else if (Yprice >= 10 && Yprice < 50)
            { LiftUnit = 0.05; }
            else if (Yprice >= 50 && Yprice < 100)
            { LiftUnit = 0.1; }
            else if (Yprice >= 100 && Yprice < 500)
            { LiftUnit = 0.5; }
            else if (Yprice >= 500 && Yprice < 1000)
            { LiftUnit = 1; }
            else if (Yprice >= 1000)
            { LiftUnit = 5; }





        Highcharts.setOptions({
            global: {
                useUTC: false
            }
        });

        Highcharts.chart('trendchart', {
            chart: {
                type: 'line',
                animation: Highcharts.svg, // don't animate in old IE
                marginRight: 10,
                //events: {
                //    load: function () {

                //        // 每秒新增
                //        var series = this.series[0];
                //        setInterval(function () {
                //            var x = (new Date()).getTime(), // current time
                //                y = Math.random();
                //            series.addPoint([x, y], true, true);
                //        }, 1000);
                //    }
                //}
            },
            plotOptions: {
                line: {
                    marker: {
                        enabled: false
                    }
                },
                series: {
                    turboThreshold: 10000 // 或者更多，另外可以直接去数据的长度
                }
            },
            title: {
                text: stock
            },
            xAxis: {
                type: 'datetime',
                tickPixelInterval: 150
            },
            yAxis: {
                title: {
                    text: ''
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }],
                max: maxprice,
                min: minprice,
                labels: {
                    style: {
                        fontSize: '11px'
                    }
                },
            },
            tooltip: {
                formatter: function () {
                    return '<b>' + this.series.name + '</b><br/>' +
                        Highcharts.dateFormat(' %H:%M:%S', this.x) + '<br/>' +   //%Y-%m-%d
                        Highcharts.numberFormat(this.y, 2);
                }
            },
            legend: {
                enabled: false
            },
            exporting: {
                enabled: false
            },
            credits: {
                enabled: false
            },

            series: [{
                name: stock,
                color: '#FF3333',
                lineWidth: 1,
                data: (function () {
                    // generate an array of random data
                    var data = [],
                        time = (new Date()).setHours(9, 0, 0), //(new Date()).getTime().
                        i;
                    for (i = 0; i <= 3240; i += 1) {  //12*60*5=3600

                        var NewLU = Math.floor(Math.random() * (maxprice - minprice + 1))
                        var NewLU2 = parseFloat(NewLU) + parseFloat(minprice)


                        if (NewLU2 > Yprice) {
                            Nprice += LiftUnit;
                            if (Nprice > maxprice) {
                                Nprice -= LiftUnit;
                            }
                        }
                        if (NewLU2 < Yprice) {
                            Nprice -= LiftUnit;
                            if (Nprice < minprice) {
                                Nprice += LiftUnit;
                            }
                        }
                        if (NewLU2 == Yprice)
                        { Nprice = Nprice; }



                        data.push({
                            x: time + i * 5 * 1000, // i * 秒數
                            y: Nprice
                        });


                    }
                    return data;
                }())
            }]
        });
        });


       Highcharts.chart('trendchart2', {
           chart: {
               type: 'column'
           },
           title: {
               text: '',
           },
           xAxis: {
               type: 'datetime',
               tickPixelInterval: 150,
               labels:
               {
                   enabled: false
               }
           },
           yAxis: {
               title: {
                   text: ''
               },
               labels: {
                   style: {
                       color: '#FF3333',
                       fontSize: '8px'
                   }
               },
               max: 1600,

           },
           legend: {
               enabled: false
           },
           tooltip: {
               //pointFormat: '量: <b>{point.y:.1f} 張</b>'
               formatter: function () {
                   return '<b>' + this.series.name + '</b><br/>' +
                       Highcharts.dateFormat(' %H:%M:%S', this.x) + '<br/>' +   //%Y-%m-%d
                       '量:' + Highcharts.numberFormat(this.y, 0) + '張';
               }
           },
           exporting: {
               enabled: false
           },
           credits: {
               enabled: false
           },
           plotOptions: {
               line: {
                   marker: {
                       enabled: false
                   }
               },
               series: {
                   turboThreshold: 10000, // 或者更多，另外可以直接去数据的长度
                   pointWidth: 0.1
               },

           },
           series: [{
               name: '交易量',
               color: '#FF3333',
               lineWidth: 0.1,
               data: (function () {
                   // generate an array of random data
                   var data = [],
                       time = (new Date()).setHours(9, 0, 0), //(new Date().getTime().
                       i;

                   for (i = 0; i <= 3240; i += 1) {  //12*60*5=3600  3240

                       var v = Math.floor(Math.random() * 15);

                       if (Math.round(i % 11) == 0) {
                           v = parseFloat(Math.floor(Math.random() * 300)) + parseFloat(25);
                       }
                       if (i == 0) {
                           v = parseFloat(Math.floor(Math.random() * 1100)) + parseFloat(500);
                       }

                       data.push({
                           x: time + i * 5 * 1000, // i * 秒數
                           y: v
                       });


                   }
                   return data;
               }()),
           }]
       });
</script>
<script>
        $.getJSON('https://tw.quote.finance.yahoo.net/quote/q?type=tick&perd=1m&mkt=10&sym=%23001&callback=?', {  }, function (datas) {

            var stock = "大盤趨勢";
            var Yprice = datas.tick[0].p;
            var maxprice = (Yprice * 1.1).toFixed(2);
            var minprice = (Yprice * 0.9).toFixed(2);
            var LiftUnit = 0.00;
            var Nprice = Yprice;

            if (Yprice < 10)
            { LiftUnit = 0.01; }
            else if (Yprice >= 10 && Yprice < 50)
            { LiftUnit = 0.05; }
            else if (Yprice >= 50 && Yprice < 100)
            { LiftUnit = 0.1; }
            else if (Yprice >= 100 && Yprice < 500)
            { LiftUnit = 0.5; }
            else if (Yprice >= 500 && Yprice < 1000)
            { LiftUnit = 1; }
            else if (Yprice >= 1000)
            { LiftUnit = 5; }





        Highcharts.setOptions({
            global: {
                useUTC: false
            }
        });

        Highcharts.chart('MarketTrendChart', {
            chart: {
                type: 'line',
                animation: Highcharts.svg, // don't animate in old IE
                marginRight: 10,
            },
            plotOptions: {
                line: {
                    marker: {
                        enabled: false
                    }
                },
                series: {
                    turboThreshold: 10000 // 或者更多，另外可以直接去数据的长度
                }
            },
            title: {
                text: stock
            },
            xAxis: {
                type: 'datetime',
                tickPixelInterval: 150
            },
            yAxis: {
                title: {
                    text: ''
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }],
                max: maxprice,
                min: minprice,
                style: {
                    color: '#FF3333',
                }
            },
            tooltip: {
                formatter: function () {
                    return '<b>' + this.series.name + '</b><br/>' +
                        Highcharts.dateFormat(' %H:%M:%S', this.x) + '<br/>' +   //%Y-%m-%d
                        Highcharts.numberFormat(this.y, 2);
                }
            },
            legend: {
                enabled: false
            },
            exporting: {
                enabled: false
            },
            credits: {
                enabled: false
            },

            series: [{
                name: stock,
                color: '#FF3333',
                lineWidth: 1,
                data: (function () {
                    // generate an array of random data
                    var data = [],
                        time = (new Date()).setHours(9, 0, 0), //(new Date()).getTime().
                        i;

                    for (i = 0; i <= 3240; i += 1) {  //12*60*5=3600

                        var NewLU = Math.floor(Math.random() * (maxprice - minprice + 1))
                        var NewLU2 = parseFloat(NewLU) + parseFloat(minprice)


                        if (NewLU2 > Yprice) {
                            Nprice += LiftUnit;
                            if (Nprice > maxprice) {
                                Nprice -= LiftUnit;
                            }
                        }
                        if (NewLU2 < Yprice) {
                            Nprice -= LiftUnit;
                            if (Nprice < minprice) {
                                Nprice += LiftUnit;
                            }
                        }
                        if (NewLU2 == Yprice)
                        { Nprice = Nprice; }

                        data.push({
                            x: time + i * 5 * 1000, // i * 秒數
                            y: Nprice
                        });
                        
                    }
                    return data;
                }())
            }]
        });

        Highcharts.chart('MarketTrendChart2', {
            chart: {
                type: 'column'
            },
            title: {
                text: '',
            },
            xAxis: {
                type: 'datetime',
                tickPixelInterval: 150,
                labels:
                {
                    enabled: false
                }
            },
            yAxis: {
                title: {
                    text: ''
                },
                labels: {
                    style: {
                        color: '#FF3333',
                        fontSize: '11px'
                    }
                },
                max: 60,

            },
            legend: {
                enabled: false
            },
            tooltip: {
                //pointFormat: '量: <b>{point.y:.1f} 張</b>'
                formatter: function () {
                    return '<b>' + this.series.name + '</b><br/>' +
                        Highcharts.dateFormat(' %H:%M:%S', this.x) + '<br/>' +   //%Y-%m-%d
                        '量:' + Highcharts.numberFormat(this.y, 0) + '億張';
                }
            },
            exporting: {
                enabled: false
            },
            credits: {
                enabled: false
            },
            plotOptions: {
                line: {
                    marker: {
                        enabled: false
                    }
                },
                series: {
                    turboThreshold: 10000, // 或者更多，另外可以直接去数据的长度
                    pointWidth: 0.1
                },

            },
            series: [{
                name: '交易量',
                color: '#FF3333',
                lineWidth: 0.1,
                data: (function () {
                    // generate an array of random data
                    var data = [],
                        time = (new Date()).setHours(9, 0, 0), //(new Date().getTime().
                        i;

                    for (i = 0; i <= 3240; i += 1) {  //12*60*5=3600  3240

                        var v = Math.floor(Math.random() * 10);

                        if (Math.round(i % 11) == 0) {
                            v = parseFloat(Math.floor(Math.random() * 30)) + parseFloat(5);
                        }
                        if (i == 0) {
                            v = parseFloat(Math.floor(Math.random() * 20)) + parseFloat(40);
                        }

                        data.push({
                            x: time + i * 5 * 1000, // i * 秒數
                            y: v
                        });


                    }
                    return data;
                }()),
            }]
        });

        });
    
</script>

}




